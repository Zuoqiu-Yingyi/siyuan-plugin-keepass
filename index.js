"use strict";var Xo=Object.defineProperty;var Qo=(t,e,n)=>e in t?Xo(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var B=(t,e,n)=>(Qo(t,typeof e!="symbol"?e+"":e,n),n);const ge=require("siyuan"),Zo="keepass",xo="Zuoqiu Yingyi",$o="https://github.com/Zuoqiu-Yingyi/siyuan-plugin-keepass",es="0.2.1",ts="2.10.3",ns=["all"],os=["all"],ss={default:"KeePass Password Manager",zh_CN:"KeePass 密码管理器",zh_CHT:"KeePass 密碼管理器"},rs={default:"A password manager based on <a href='https://keeweb.info/'>KeeWeb</a>, compatibling with <a href='https://keepass.info/'>KeePass</a> 3.x and 4.x databases <code class='fn__code'>*.kdbx</code>",zh_CN:"基于 <a href='https://keeweb.info/'>KeeWeb</a> 的密码管理器，兼容 <a href='https://keepass.info/'>KeePass</a> 3.x 与 4.x 数据库 <code class='fn__code'>*.kdbx</code>",zh_CHT:"基於 <a href='https://keeweb.info/'>KeeWeb</a> 的密碼管理器，兼容 <a href='https://keepass.info/'>KeePass</a> 3.x 與 4.x 數據庫 <code class='fn__code'>*.kdbx</code>"},is={default:"README.md",zh_CN:"README_zh_CN.md",zh_CHT:"README_zh_CN.md"},as={openCollective:"",patreon:"",github:"",custom:["https://afdian.net/a/zuoqiu","https://ko-fi.com/zuoqiu"]},ls={name:Zo,author:xo,url:$o,version:es,minAppVersion:ts,backends:ns,frontends:os,displayName:ss,description:rs,readme:is,funding:as},cs=(t,e)=>e.some(n=>t instanceof n);let Qt,Zt;function us(){return Qt||(Qt=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function fs(){return Zt||(Zt=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const uo=new WeakMap,Et=new WeakMap,fo=new WeakMap,ut=new WeakMap,jt=new WeakMap;function hs(t){const e=new Promise((n,o)=>{const s=()=>{t.removeEventListener("success",r),t.removeEventListener("error",i)},r=()=>{n(_e(t.result)),s()},i=()=>{o(t.error),s()};t.addEventListener("success",r),t.addEventListener("error",i)});return e.then(n=>{n instanceof IDBCursor&&uo.set(n,t)}).catch(()=>{}),jt.set(e,t),e}function ds(t){if(Et.has(t))return;const e=new Promise((n,o)=>{const s=()=>{t.removeEventListener("complete",r),t.removeEventListener("error",i),t.removeEventListener("abort",i)},r=()=>{n(),s()},i=()=>{o(t.error||new DOMException("AbortError","AbortError")),s()};t.addEventListener("complete",r),t.addEventListener("error",i),t.addEventListener("abort",i)});Et.set(t,e)}let Tt={get(t,e,n){if(t instanceof IDBTransaction){if(e==="done")return Et.get(t);if(e==="objectStoreNames")return t.objectStoreNames||fo.get(t);if(e==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return _e(t[e])},set(t,e,n){return t[e]=n,!0},has(t,e){return t instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in t}};function ps(t){Tt=t(Tt)}function ms(t){return t===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...n){const o=t.call(ft(this),e,...n);return fo.set(o,e.sort?e.sort():[e]),_e(o)}:fs().includes(t)?function(...e){return t.apply(ft(this),e),_e(uo.get(this))}:function(...e){return _e(t.apply(ft(this),e))}}function gs(t){return typeof t=="function"?ms(t):(t instanceof IDBTransaction&&ds(t),cs(t,us())?new Proxy(t,Tt):t)}function _e(t){if(t instanceof IDBRequest)return hs(t);if(ut.has(t))return ut.get(t);const e=gs(t);return e!==t&&(ut.set(t,e),jt.set(e,t)),e}const ft=t=>jt.get(t);function xt(t,e,{blocked:n,upgrade:o,blocking:s,terminated:r}={}){const i=indexedDB.open(t,e),a=_e(i);return o&&i.addEventListener("upgradeneeded",l=>{o(_e(i.result),l.oldVersion,l.newVersion,_e(i.transaction),l)}),n&&i.addEventListener("blocked",l=>n(l.oldVersion,l.newVersion,l)),a.then(l=>{r&&l.addEventListener("close",()=>r()),s&&l.addEventListener("versionchange",u=>s(u.oldVersion,u.newVersion,u))}).catch(()=>{}),a}const bs=["get","getKey","getAll","getAllKeys","count"],_s=["put","add","delete","clear"],ht=new Map;function $t(t,e){if(!(t instanceof IDBDatabase&&!(e in t)&&typeof e=="string"))return;if(ht.get(e))return ht.get(e);const n=e.replace(/FromIndex$/,""),o=e!==n,s=_s.includes(n);if(!(n in(o?IDBIndex:IDBObjectStore).prototype)||!(s||bs.includes(n)))return;const r=async function(i,...a){const l=this.transaction(i,s?"readwrite":"readonly");let u=l.store;return o&&(u=u.index(a.shift())),(await Promise.all([u[n](...a),s&&l.done]))[0]};return ht.set(e,r),r}ps(t=>({...t,get:(e,n,o)=>$t(e,n)||t.get(e,n,o),has:(e,n)=>!!$t(e,n)||t.has(e,n)}));var ys=Object.defineProperty,ws=(t,e,n)=>e in t?ys(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,he=(t,e,n)=>(ws(t,typeof e!="symbol"?e+"":e,n),n);const ks=/"(?:_|\\u0{2}5[Ff]){2}(?:p|\\u0{2}70)(?:r|\\u0{2}72)(?:o|\\u0{2}6[Ff])(?:t|\\u0{2}74)(?:o|\\u0{2}6[Ff])(?:_|\\u0{2}5[Ff]){2}"\s*:/,Ss=/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/,Es=/^\s*["[{]|^\s*-?\d{1,16}(\.\d{1,17})?([Ee][+-]?\d+)?\s*$/;function Ts(t,e){if(t==="__proto__"||t==="constructor"&&e&&typeof e=="object"&&"prototype"in e){vs(t);return}return e}function vs(t){console.warn(`[destr] Dropping "${t}" key to prevent prototype pollution.`)}function As(t,e={}){if(typeof t!="string")return t;const n=t.trim();if(t[0]==='"'&&t.at(-1)==='"'&&!t.includes("\\"))return n.slice(1,-1);if(n.length<=9){const o=n.toLowerCase();if(o==="true")return!0;if(o==="false")return!1;if(o==="undefined")return;if(o==="null")return null;if(o==="nan")return Number.NaN;if(o==="infinity")return Number.POSITIVE_INFINITY;if(o==="-infinity")return Number.NEGATIVE_INFINITY}if(!Es.test(t)){if(e.strict)throw new SyntaxError("[destr] Invalid JSON");return t}try{if(ks.test(t)||Ss.test(t)){if(e.strict)throw new Error("[destr] Possible prototype pollution");return JSON.parse(t,Ts)}return JSON.parse(t)}catch(o){if(e.strict)throw o;return t}}const Os=/#/g,Ps=/&/g,Cs=/=/g,Ft=/\+/g,Bs=/%5e/gi,Ls=/%60/gi,Ds=/%7c/gi,Is=/%20/gi;function Ns(t){return encodeURI(""+t).replace(Ds,"|")}function vt(t){return Ns(typeof t=="string"?t:JSON.stringify(t)).replace(Ft,"%2B").replace(Is,"+").replace(Os,"%23").replace(Ps,"%26").replace(Ls,"`").replace(Bs,"^")}function dt(t){return vt(t).replace(Cs,"%3D")}function ho(t=""){try{return decodeURIComponent(""+t)}catch{return""+t}}function Rs(t){return ho(t.replace(Ft," "))}function Ms(t){return ho(t.replace(Ft," "))}function js(t=""){const e={};t[0]==="?"&&(t=t.slice(1));for(const n of t.split("&")){const o=n.match(/([^=]+)=?(.*)/)||[];if(o.length<2)continue;const s=Rs(o[1]);if(s==="__proto__"||s==="constructor")continue;const r=Ms(o[2]||"");e[s]===void 0?e[s]=r:Array.isArray(e[s])?e[s].push(r):e[s]=[e[s],r]}return e}function Fs(t,e){return(typeof e=="number"||typeof e=="boolean")&&(e=String(e)),e?Array.isArray(e)?e.map(n=>`${dt(t)}=${vt(n)}`).join("&"):`${dt(t)}=${vt(e)}`:dt(t)}function Us(t){return Object.keys(t).filter(e=>t[e]!==void 0).map(e=>Fs(e,t[e])).filter(Boolean).join("&")}const qs=/^[\s\w\0+.-]{2,}:([/\\]{1,2})/,Ws=/^[\s\w\0+.-]{2,}:([/\\]{2})?/,Ks=/^([/\\]\s*){2,}[^/\\]/;function po(t,e={}){return typeof e=="boolean"&&(e={acceptRelative:e}),e.strict?qs.test(t):Ws.test(t)||(e.acceptRelative?Ks.test(t):!1)}const Hs=/\/$|\/\?|\/#/;function At(t="",e){return e?Hs.test(t):t.endsWith("/")}function zs(t="",e){if(!e)return(At(t)?t.slice(0,-1):t)||"/";if(!At(t,!0))return t||"/";let n=t,o="";const s=t.indexOf("#");s>=0&&(n=t.slice(0,s),o=t.slice(s));const[r,...i]=n.split("?");return(r.slice(0,-1)||"/")+(i.length>0?`?${i.join("?")}`:"")+o}function Gs(t="",e){if(!e)return t.endsWith("/")?t:t+"/";if(At(t,!0))return t||"/";let n=t,o="";const s=t.indexOf("#");if(s>=0&&(n=t.slice(0,s),o=t.slice(s),!n))return o;const[r,...i]=n.split("?");return r+"/"+(i.length>0?`?${i.join("?")}`:"")+o}function Vs(t,e){if(Ys(e)||po(t))return t;const n=zs(e);return t.startsWith(n)?t:Zs(n,t)}function Js(t,e){const n=mo(t),o={...js(n.search),...e};return n.search=Us(o),xs(n)}function Ys(t){return!t||t==="/"}function Xs(t){return t&&t!=="/"}const Qs=/^\.?\//;function Zs(t,...e){let n=t||"";for(const o of e.filter(s=>Xs(s)))if(n){const s=o.replace(Qs,"");n=Gs(n)+s}else n=o;return n}function mo(t="",e){const n=t.match(/^[\s\0]*(blob:|data:|javascript:|vbscript:)(.*)/i);if(n){const[,f,g=""]=n;return{protocol:f.toLowerCase(),pathname:g,href:f+g,auth:"",host:"",search:"",hash:""}}if(!po(t,{acceptRelative:!0}))return e?mo(e+t):en(t);const[,o="",s,r=""]=t.replace(/\\/g,"/").match(/^[\s\0]*([\w+.-]{2,}:)?\/\/([^/@]+@)?(.*)/)||[],[,i="",a=""]=r.match(/([^#/?]*)(.*)?/)||[],{pathname:l,search:u,hash:c}=en(a.replace(/\/(?=[A-Za-z]:)/,""));return{protocol:o.toLowerCase(),auth:s?s.slice(0,Math.max(0,s.length-1)):"",host:i,pathname:l,search:u,hash:c}}function en(t=""){const[e="",n="",o=""]=(t.match(/([^#?]*)(\?[^#]*)?(#.*)?/)||[]).splice(1);return{pathname:e,search:n,hash:o}}function xs(t){const e=t.pathname||"",n=t.search?(t.search.startsWith("?")?"":"?")+t.search:"",o=t.hash||"",s=t.auth?t.auth+"@":"",r=t.host||"";return(t.protocol?t.protocol+"//":"")+s+r+e+n+o}class $s extends Error{constructor(e,n){super(e,n),this.name="FetchError",n!=null&&n.cause&&!this.cause&&(this.cause=n.cause)}}function er(t){var e,n,o,s,r;const i=((e=t.error)==null?void 0:e.message)||((n=t.error)==null?void 0:n.toString())||"",a=((o=t.request)==null?void 0:o.method)||((s=t.options)==null?void 0:s.method)||"GET",l=((r=t.request)==null?void 0:r.url)||String(t.request)||"/",u=`[${a}] ${JSON.stringify(l)}`,c=t.response?`${t.response.status} ${t.response.statusText}`:"<no response>",f=`${u}: ${c}${i?` ${i}`:""}`,g=new $s(f,t.error?{cause:t.error}:void 0);for(const d of["request","options","response"])Object.defineProperty(g,d,{get(){return t[d]}});for(const[d,h]of[["data","_data"],["status","status"],["statusCode","status"],["statusText","statusText"],["statusMessage","statusText"]])Object.defineProperty(g,d,{get(){return t.response&&t.response[h]}});return g}const tr=new Set(Object.freeze(["PATCH","POST","PUT","DELETE"]));function tn(t="GET"){return tr.has(t.toUpperCase())}function nr(t){if(t===void 0)return!1;const e=typeof t;return e==="string"||e==="number"||e==="boolean"||e===null?!0:e!=="object"?!1:Array.isArray(t)?!0:t.buffer?!1:t.constructor&&t.constructor.name==="Object"||typeof t.toJSON=="function"}const or=new Set(["image/svg","application/xml","application/xhtml","application/html"]),sr=/^application\/(?:[\w!#$%&*.^`~-]*\+)?json(;.+)?$/i;function rr(t=""){if(!t)return"json";const e=t.split(";").shift()||"";return sr.test(e)?"json":or.has(e)||e.startsWith("text/")?"text":"blob"}function ir(t,e,n=globalThis.Headers){const o={...e,...t};if(e!=null&&e.params&&t!=null&&t.params&&(o.params={...e==null?void 0:e.params,...t==null?void 0:t.params}),e!=null&&e.query&&t!=null&&t.query&&(o.query={...e==null?void 0:e.query,...t==null?void 0:t.query}),e!=null&&e.headers&&t!=null&&t.headers){o.headers=new n((e==null?void 0:e.headers)||{});for(const[s,r]of new n((t==null?void 0:t.headers)||{}))o.headers.set(s,r)}return o}const ar=new Set([408,409,425,429,500,502,503,504]),lr=new Set([101,204,205,304]);function go(t={}){const{fetch:e=globalThis.fetch,Headers:n=globalThis.Headers,AbortController:o=globalThis.AbortController}=t;async function s(a){const l=a.error&&a.error.name==="AbortError"&&!a.options.timeout||!1;if(a.options.retry!==!1&&!l){let c;typeof a.options.retry=="number"?c=a.options.retry:c=tn(a.options.method)?0:1;const f=a.response&&a.response.status||500;if(c>0&&(Array.isArray(a.options.retryStatusCodes)?a.options.retryStatusCodes.includes(f):ar.has(f))){const g=a.options.retryDelay||0;return g>0&&await new Promise(d=>setTimeout(d,g)),r(a.request,{...a.options,retry:c-1,timeout:a.options.timeout})}}const u=er(a);throw Error.captureStackTrace&&Error.captureStackTrace(u,r),u}const r=async function(a,l={}){var u;const c={request:a,options:ir(l,t.defaults,n),response:void 0,error:void 0};if(c.options.method=(u=c.options.method)==null?void 0:u.toUpperCase(),c.options.onRequest&&await c.options.onRequest(c),typeof c.request=="string"&&(c.options.baseURL&&(c.request=Vs(c.request,c.options.baseURL)),(c.options.query||c.options.params)&&(c.request=Js(c.request,{...c.options.params,...c.options.query}))),c.options.body&&tn(c.options.method)&&(nr(c.options.body)?(c.options.body=typeof c.options.body=="string"?c.options.body:JSON.stringify(c.options.body),c.options.headers=new n(c.options.headers||{}),c.options.headers.has("content-type")||c.options.headers.set("content-type","application/json"),c.options.headers.has("accept")||c.options.headers.set("accept","application/json")):("pipeTo"in c.options.body&&typeof c.options.body.pipeTo=="function"||typeof c.options.body.pipe=="function")&&("duplex"in c.options||(c.options.duplex="half"))),!c.options.signal&&c.options.timeout){const f=new o;setTimeout(()=>f.abort(),c.options.timeout),c.options.signal=f.signal}try{c.response=await e(c.request,c.options)}catch(f){return c.error=f,c.options.onRequestError&&await c.options.onRequestError(c),await s(c)}if(c.response.body&&!lr.has(c.response.status)&&c.options.method!=="HEAD"){const f=(c.options.parseResponse?"json":c.options.responseType)||rr(c.response.headers.get("content-type")||"");switch(f){case"json":{const g=await c.response.text(),d=c.options.parseResponse||As;c.response._data=d(g);break}case"stream":{c.response._data=c.response.body;break}default:c.response._data=await c.response[f]()}}return c.options.onResponse&&await c.options.onResponse(c),!c.options.ignoreResponseError&&c.response.status>=400&&c.response.status<600?(c.options.onResponseError&&await c.options.onResponseError(c),await s(c)):c.response},i=async function(a,l){return(await r(a,l))._data};return i.raw=r,i.native=(...a)=>e(...a),i.create=(a={})=>go({...t,defaults:{...t.defaults,...a}}),i}const Ut=function(){if(typeof globalThis<"u")return globalThis;if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")}(),cr=Ut.fetch||(()=>Promise.reject(new Error("[ofetch] global.fetch is not supported!"))),ur=Ut.Headers,fr=Ut.AbortController,hr=go({fetch:cr,Headers:ur,AbortController:fr});class dr extends Error{constructor(e){super(e.statusText),he(this,"status"),this.response=e,this.status=e.status}}class nn extends Error{constructor(e,n){super(e.msg),he(this,"code"),this.body=e,this.response=n,this.code=e.code}}function ae(t){if(typeof t!="string")throw new TypeError("Path must be a string. Received "+JSON.stringify(t))}function on(t,e){for(var n="",o=0,s=-1,r=0,i,a=0;a<=t.length;++a){if(a<t.length)i=t.charCodeAt(a);else{if(i===47)break;i=47}if(i===47){if(!(s===a-1||r===1))if(s!==a-1&&r===2){if(n.length<2||o!==2||n.charCodeAt(n.length-1)!==46||n.charCodeAt(n.length-2)!==46){if(n.length>2){var l=n.lastIndexOf("/");if(l!==n.length-1){l===-1?(n="",o=0):(n=n.slice(0,l),o=n.length-1-n.lastIndexOf("/")),s=a,r=0;continue}}else if(n.length===2||n.length===1){n="",o=0,s=a,r=0;continue}}e&&(n.length>0?n+="/..":n="..",o=2)}else n.length>0?n+="/"+t.slice(s+1,a):n=t.slice(s+1,a),o=a-s-1;s=a,r=0}else i===46&&r!==-1?++r:r=-1}return n}function pr(t,e){var n=e.dir||e.root,o=e.base||(e.name||"")+(e.ext||"");return n?n===e.root?n+o:n+t+o:o}var Me={resolve:function(){for(var t="",e=!1,n,o=arguments.length-1;o>=-1&&!e;o--){var s;o>=0?s=arguments[o]:(n===void 0&&(n=process.cwd()),s=n),ae(s),s.length!==0&&(t=s+"/"+t,e=s.charCodeAt(0)===47)}return t=on(t,!e),e?t.length>0?"/"+t:"/":t.length>0?t:"."},normalize:function(t){if(ae(t),t.length===0)return".";var e=t.charCodeAt(0)===47,n=t.charCodeAt(t.length-1)===47;return t=on(t,!e),t.length===0&&!e&&(t="."),t.length>0&&n&&(t+="/"),e?"/"+t:t},isAbsolute:function(t){return ae(t),t.length>0&&t.charCodeAt(0)===47},join:function(){if(arguments.length===0)return".";for(var t,e=0;e<arguments.length;++e){var n=arguments[e];ae(n),n.length>0&&(t===void 0?t=n:t+="/"+n)}return t===void 0?".":Me.normalize(t)},relative:function(t,e){if(ae(t),ae(e),t===e||(t=Me.resolve(t),e=Me.resolve(e),t===e))return"";for(var n=1;n<t.length&&t.charCodeAt(n)===47;++n);for(var o=t.length,s=o-n,r=1;r<e.length&&e.charCodeAt(r)===47;++r);for(var i=e.length,a=i-r,l=s<a?s:a,u=-1,c=0;c<=l;++c){if(c===l){if(a>l){if(e.charCodeAt(r+c)===47)return e.slice(r+c+1);if(c===0)return e.slice(r+c)}else s>l&&(t.charCodeAt(n+c)===47?u=c:c===0&&(u=0));break}var f=t.charCodeAt(n+c),g=e.charCodeAt(r+c);if(f!==g)break;f===47&&(u=c)}var d="";for(c=n+u+1;c<=o;++c)(c===o||t.charCodeAt(c)===47)&&(d.length===0?d+="..":d+="/..");return d.length>0?d+e.slice(r+u):(r+=u,e.charCodeAt(r)===47&&++r,e.slice(r))},_makeLong:function(t){return t},dirname:function(t){if(ae(t),t.length===0)return".";for(var e=t.charCodeAt(0),n=e===47,o=-1,s=!0,r=t.length-1;r>=1;--r)if(e=t.charCodeAt(r),e===47){if(!s){o=r;break}}else s=!1;return o===-1?n?"/":".":n&&o===1?"//":t.slice(0,o)},basename:function(t,e){if(e!==void 0&&typeof e!="string")throw new TypeError('"ext" argument must be a string');ae(t);var n=0,o=-1,s=!0,r;if(e!==void 0&&e.length>0&&e.length<=t.length){if(e.length===t.length&&e===t)return"";var i=e.length-1,a=-1;for(r=t.length-1;r>=0;--r){var l=t.charCodeAt(r);if(l===47){if(!s){n=r+1;break}}else a===-1&&(s=!1,a=r+1),i>=0&&(l===e.charCodeAt(i)?--i===-1&&(o=r):(i=-1,o=a))}return n===o?o=a:o===-1&&(o=t.length),t.slice(n,o)}else{for(r=t.length-1;r>=0;--r)if(t.charCodeAt(r)===47){if(!s){n=r+1;break}}else o===-1&&(s=!1,o=r+1);return o===-1?"":t.slice(n,o)}},extname:function(t){ae(t);for(var e=-1,n=0,o=-1,s=!0,r=0,i=t.length-1;i>=0;--i){var a=t.charCodeAt(i);if(a===47){if(!s){n=i+1;break}continue}o===-1&&(s=!1,o=i+1),a===46?e===-1?e=i:r!==1&&(r=1):e!==-1&&(r=-1)}return e===-1||o===-1||r===0||r===1&&e===o-1&&e===n+1?"":t.slice(e,o)},format:function(t){if(t===null||typeof t!="object")throw new TypeError('The "pathObject" argument must be of type Object. Received type '+typeof t);return pr("/",t)},parse:function(t){ae(t);var e={root:"",dir:"",base:"",ext:"",name:""};if(t.length===0)return e;var n=t.charCodeAt(0),o=n===47,s;o?(e.root="/",s=1):s=0;for(var r=-1,i=0,a=-1,l=!0,u=t.length-1,c=0;u>=s;--u){if(n=t.charCodeAt(u),n===47){if(!l){i=u+1;break}continue}a===-1&&(l=!1,a=u+1),n===46?r===-1?r=u:c!==1&&(c=1):r!==-1&&(c=-1)}return r===-1||a===-1||c===0||c===1&&r===a-1&&r===i+1?a!==-1&&(i===0&&o?e.base=e.name=t.slice(1,a):e.base=e.name=t.slice(i,a)):(i===0&&o?(e.name=t.slice(1,r),e.base=t.slice(1,a)):(e.name=t.slice(i,r),e.base=t.slice(i,a)),e.ext=t.slice(r,a)),i>0?e.dir=t.slice(0,i-1):o&&(e.dir="/"),e},sep:"/",delimiter:":",win32:null,posix:null};Me.posix=Me;function bo(t,e){return function(){return t.apply(e,arguments)}}const{toString:mr}=Object.prototype,{getPrototypeOf:qt}=Object,tt=(t=>e=>{const n=mr.call(e);return t[n]||(t[n]=n.slice(8,-1).toLowerCase())})(Object.create(null)),fe=t=>(t=t.toLowerCase(),e=>tt(e)===t),nt=t=>e=>typeof e===t,{isArray:De}=Array,Fe=nt("undefined");function gr(t){return t!==null&&!Fe(t)&&t.constructor!==null&&!Fe(t.constructor)&&oe(t.constructor.isBuffer)&&t.constructor.isBuffer(t)}const _o=fe("ArrayBuffer");function br(t){let e;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?e=ArrayBuffer.isView(t):e=t&&t.buffer&&_o(t.buffer),e}const _r=nt("string"),oe=nt("function"),yo=nt("number"),ot=t=>t!==null&&typeof t=="object",yr=t=>t===!0||t===!1,Ye=t=>{if(tt(t)!=="object")return!1;const e=qt(t);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in t)&&!(Symbol.iterator in t)},wr=fe("Date"),kr=fe("File"),Sr=fe("Blob"),Er=fe("FileList"),Tr=t=>ot(t)&&oe(t.pipe),vr=t=>{let e;return t&&(typeof FormData=="function"&&t instanceof FormData||oe(t.append)&&((e=tt(t))==="formdata"||e==="object"&&oe(t.toString)&&t.toString()==="[object FormData]"))},Ar=fe("URLSearchParams"),Or=t=>t.trim?t.trim():t.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function We(t,e,{allOwnKeys:n=!1}={}){if(t===null||typeof t>"u")return;let o,s;if(typeof t!="object"&&(t=[t]),De(t))for(o=0,s=t.length;o<s;o++)e.call(null,t[o],o,t);else{const r=n?Object.getOwnPropertyNames(t):Object.keys(t),i=r.length;let a;for(o=0;o<i;o++)a=r[o],e.call(null,t[a],a,t)}}function wo(t,e){e=e.toLowerCase();const n=Object.keys(t);let o=n.length,s;for(;o-- >0;)if(s=n[o],e===s.toLowerCase())return s;return null}const ko=(()=>typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global)(),So=t=>!Fe(t)&&t!==ko;function Ot(){const{caseless:t}=So(this)&&this||{},e={},n=(o,s)=>{const r=t&&wo(e,s)||s;Ye(e[r])&&Ye(o)?e[r]=Ot(e[r],o):Ye(o)?e[r]=Ot({},o):De(o)?e[r]=o.slice():e[r]=o};for(let o=0,s=arguments.length;o<s;o++)arguments[o]&&We(arguments[o],n);return e}const Pr=(t,e,n,{allOwnKeys:o}={})=>(We(e,(s,r)=>{n&&oe(s)?t[r]=bo(s,n):t[r]=s},{allOwnKeys:o}),t),Cr=t=>(t.charCodeAt(0)===65279&&(t=t.slice(1)),t),Br=(t,e,n,o)=>{t.prototype=Object.create(e.prototype,o),t.prototype.constructor=t,Object.defineProperty(t,"super",{value:e.prototype}),n&&Object.assign(t.prototype,n)},Lr=(t,e,n,o)=>{let s,r,i;const a={};if(e=e||{},t==null)return e;do{for(s=Object.getOwnPropertyNames(t),r=s.length;r-- >0;)i=s[r],(!o||o(i,t,e))&&!a[i]&&(e[i]=t[i],a[i]=!0);t=n!==!1&&qt(t)}while(t&&(!n||n(t,e))&&t!==Object.prototype);return e},Dr=(t,e,n)=>{t=String(t),(n===void 0||n>t.length)&&(n=t.length),n-=e.length;const o=t.indexOf(e,n);return o!==-1&&o===n},Ir=t=>{if(!t)return null;if(De(t))return t;let e=t.length;if(!yo(e))return null;const n=new Array(e);for(;e-- >0;)n[e]=t[e];return n},Nr=(t=>e=>t&&e instanceof t)(typeof Uint8Array<"u"&&qt(Uint8Array)),Rr=(t,e)=>{const n=(t&&t[Symbol.iterator]).call(t);let o;for(;(o=n.next())&&!o.done;){const s=o.value;e.call(t,s[0],s[1])}},Mr=(t,e)=>{let n;const o=[];for(;(n=t.exec(e))!==null;)o.push(n);return o},jr=fe("HTMLFormElement"),Fr=t=>t.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(e,n,o){return n.toUpperCase()+o}),sn=(({hasOwnProperty:t})=>(e,n)=>t.call(e,n))(Object.prototype),Ur=fe("RegExp"),Eo=(t,e)=>{const n=Object.getOwnPropertyDescriptors(t),o={};We(n,(s,r)=>{let i;(i=e(s,r,t))!==!1&&(o[r]=i||s)}),Object.defineProperties(t,o)},qr=t=>{Eo(t,(e,n)=>{if(oe(t)&&["arguments","caller","callee"].indexOf(n)!==-1)return!1;const o=t[n];if(oe(o)){if(e.enumerable=!1,"writable"in e){e.writable=!1;return}e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+n+"'")})}})},Wr=(t,e)=>{const n={},o=s=>{s.forEach(r=>{n[r]=!0})};return De(t)?o(t):o(String(t).split(e)),n},Kr=()=>{},Hr=(t,e)=>(t=+t,Number.isFinite(t)?t:e),pt="abcdefghijklmnopqrstuvwxyz",rn="0123456789",To={DIGIT:rn,ALPHA:pt,ALPHA_DIGIT:pt+pt.toUpperCase()+rn},zr=(t=16,e=To.ALPHA_DIGIT)=>{let n="";const{length:o}=e;for(;t--;)n+=e[Math.random()*o|0];return n};function Gr(t){return!!(t&&oe(t.append)&&t[Symbol.toStringTag]==="FormData"&&t[Symbol.iterator])}const Vr=t=>{const e=new Array(10),n=(o,s)=>{if(ot(o)){if(e.indexOf(o)>=0)return;if(!("toJSON"in o)){e[s]=o;const r=De(o)?[]:{};return We(o,(i,a)=>{const l=n(i,s+1);!Fe(l)&&(r[a]=l)}),e[s]=void 0,r}}return o};return n(t,0)},Jr=fe("AsyncFunction"),Yr=t=>t&&(ot(t)||oe(t))&&oe(t.then)&&oe(t.catch),_={isArray:De,isArrayBuffer:_o,isBuffer:gr,isFormData:vr,isArrayBufferView:br,isString:_r,isNumber:yo,isBoolean:yr,isObject:ot,isPlainObject:Ye,isUndefined:Fe,isDate:wr,isFile:kr,isBlob:Sr,isRegExp:Ur,isFunction:oe,isStream:Tr,isURLSearchParams:Ar,isTypedArray:Nr,isFileList:Er,forEach:We,merge:Ot,extend:Pr,trim:Or,stripBOM:Cr,inherits:Br,toFlatObject:Lr,kindOf:tt,kindOfTest:fe,endsWith:Dr,toArray:Ir,forEachEntry:Rr,matchAll:Mr,isHTMLForm:jr,hasOwnProperty:sn,hasOwnProp:sn,reduceDescriptors:Eo,freezeMethods:qr,toObjectSet:Wr,toCamelCase:Fr,noop:Kr,toFiniteNumber:Hr,findKey:wo,global:ko,isContextDefined:So,ALPHABET:To,generateString:zr,isSpecCompliantForm:Gr,toJSONObject:Vr,isAsyncFn:Jr,isThenable:Yr};function D(t,e,n,o,s){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=t,this.name="AxiosError",e&&(this.code=e),n&&(this.config=n),o&&(this.request=o),s&&(this.response=s)}_.inherits(D,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:_.toJSONObject(this.config),code:this.code,status:this.response&&this.response.status?this.response.status:null}}});const vo=D.prototype,Ao={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(t=>{Ao[t]={value:t}});Object.defineProperties(D,Ao);Object.defineProperty(vo,"isAxiosError",{value:!0});D.from=(t,e,n,o,s,r)=>{const i=Object.create(vo);return _.toFlatObject(t,i,function(a){return a!==Error.prototype},a=>a!=="isAxiosError"),D.call(i,t.message,e,n,o,s),i.cause=t,i.name=t.name,r&&Object.assign(i,r),i};const Xr=null;function Pt(t){return _.isPlainObject(t)||_.isArray(t)}function Oo(t){return _.endsWith(t,"[]")?t.slice(0,-2):t}function an(t,e,n){return t?t.concat(e).map(function(o,s){return o=Oo(o),!n&&s?"["+o+"]":o}).join(n?".":""):e}function Qr(t){return _.isArray(t)&&!t.some(Pt)}const Zr=_.toFlatObject(_,{},null,function(t){return/^is[A-Z]/.test(t)});function st(t,e,n){if(!_.isObject(t))throw new TypeError("target must be an object");e=e||new FormData,n=_.toFlatObject(n,{metaTokens:!0,dots:!1,indexes:!1},!1,function(d,h){return!_.isUndefined(h[d])});const o=n.metaTokens,s=n.visitor||u,r=n.dots,i=n.indexes,a=(n.Blob||typeof Blob<"u"&&Blob)&&_.isSpecCompliantForm(e);if(!_.isFunction(s))throw new TypeError("visitor must be a function");function l(d){if(d===null)return"";if(_.isDate(d))return d.toISOString();if(!a&&_.isBlob(d))throw new D("Blob is not supported. Use a Buffer instead.");return _.isArrayBuffer(d)||_.isTypedArray(d)?a&&typeof Blob=="function"?new Blob([d]):Buffer.from(d):d}function u(d,h,b){let p=d;if(d&&!b&&typeof d=="object"){if(_.endsWith(h,"{}"))h=o?h:h.slice(0,-2),d=JSON.stringify(d);else if(_.isArray(d)&&Qr(d)||(_.isFileList(d)||_.endsWith(h,"[]"))&&(p=_.toArray(d)))return h=Oo(h),p.forEach(function(C,G){!(_.isUndefined(C)||C===null)&&e.append(i===!0?an([h],G,r):i===null?h:h+"[]",l(C))}),!1}return Pt(d)?!0:(e.append(an(b,h,r),l(d)),!1)}const c=[],f=Object.assign(Zr,{defaultVisitor:u,convertValue:l,isVisitable:Pt});function g(d,h){if(!_.isUndefined(d)){if(c.indexOf(d)!==-1)throw Error("Circular reference detected in "+h.join("."));c.push(d),_.forEach(d,function(b,p){(!(_.isUndefined(b)||b===null)&&s.call(e,b,_.isString(p)?p.trim():p,h,f))===!0&&g(b,h?h.concat(p):[p])}),c.pop()}}if(!_.isObject(t))throw new TypeError("data must be an object");return g(t),e}function ln(t){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(t).replace(/[!'()~]|%20|%00/g,function(n){return e[n]})}function Wt(t,e){this._pairs=[],t&&st(t,this,e)}const Po=Wt.prototype;Po.append=function(t,e){this._pairs.push([t,e])};Po.toString=function(t){const e=t?function(n){return t.call(this,n,ln)}:ln;return this._pairs.map(function(n){return e(n[0])+"="+e(n[1])},"").join("&")};function xr(t){return encodeURIComponent(t).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function Co(t,e,n){if(!e)return t;const o=n&&n.encode||xr,s=n&&n.serialize;let r;if(s?r=s(e,n):r=_.isURLSearchParams(e)?e.toString():new Wt(e,n).toString(o),r){const i=t.indexOf("#");i!==-1&&(t=t.slice(0,i)),t+=(t.indexOf("?")===-1?"?":"&")+r}return t}class $r{constructor(){this.handlers=[]}use(e,n,o){return this.handlers.push({fulfilled:e,rejected:n,synchronous:o?o.synchronous:!1,runWhen:o?o.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){_.forEach(this.handlers,function(n){n!==null&&e(n)})}}const cn=$r,Bo={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},ei=typeof URLSearchParams<"u"?URLSearchParams:Wt,ti=typeof FormData<"u"?FormData:null,ni=typeof Blob<"u"?Blob:null,oi={isBrowser:!0,classes:{URLSearchParams:ei,FormData:ti,Blob:ni},protocols:["http","https","file","blob","url","data"]},Lo=typeof window<"u"&&typeof document<"u",si=(t=>Lo&&["ReactNative","NativeScript","NS"].indexOf(t)<0)(typeof navigator<"u"&&navigator.product),ri=(()=>typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function")(),ii=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:Lo,hasStandardBrowserEnv:si,hasStandardBrowserWebWorkerEnv:ri},Symbol.toStringTag,{value:"Module"})),ce={...ii,...oi};function ai(t,e){return st(t,new ce.classes.URLSearchParams,Object.assign({visitor:function(n,o,s,r){return ce.isNode&&_.isBuffer(n)?(this.append(o,n.toString("base64")),!1):r.defaultVisitor.apply(this,arguments)}},e))}function li(t){return _.matchAll(/\w+|\[(\w*)]/g,t).map(e=>e[0]==="[]"?"":e[1]||e[0])}function ci(t){const e={},n=Object.keys(t);let o;const s=n.length;let r;for(o=0;o<s;o++)r=n[o],e[r]=t[r];return e}function Do(t){function e(n,o,s,r){let i=n[r++];const a=Number.isFinite(+i),l=r>=n.length;return i=!i&&_.isArray(s)?s.length:i,l?(_.hasOwnProp(s,i)?s[i]=[s[i],o]:s[i]=o,!a):((!s[i]||!_.isObject(s[i]))&&(s[i]=[]),e(n,o,s[i],r)&&_.isArray(s[i])&&(s[i]=ci(s[i])),!a)}if(_.isFormData(t)&&_.isFunction(t.entries)){const n={};return _.forEachEntry(t,(o,s)=>{e(li(o),s,n,0)}),n}return null}function ui(t,e,n){if(_.isString(t))try{return(e||JSON.parse)(t),_.trim(t)}catch(o){if(o.name!=="SyntaxError")throw o}return(n||JSON.stringify)(t)}const Kt={transitional:Bo,adapter:["xhr","http"],transformRequest:[function(t,e){const n=e.getContentType()||"",o=n.indexOf("application/json")>-1,s=_.isObject(t);if(s&&_.isHTMLForm(t)&&(t=new FormData(t)),_.isFormData(t))return o&&o?JSON.stringify(Do(t)):t;if(_.isArrayBuffer(t)||_.isBuffer(t)||_.isStream(t)||_.isFile(t)||_.isBlob(t))return t;if(_.isArrayBufferView(t))return t.buffer;if(_.isURLSearchParams(t))return e.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),t.toString();let r;if(s){if(n.indexOf("application/x-www-form-urlencoded")>-1)return ai(t,this.formSerializer).toString();if((r=_.isFileList(t))||n.indexOf("multipart/form-data")>-1){const i=this.env&&this.env.FormData;return st(r?{"files[]":t}:t,i&&new i,this.formSerializer)}}return s||o?(e.setContentType("application/json",!1),ui(t)):t}],transformResponse:[function(t){const e=this.transitional||Kt.transitional,n=e&&e.forcedJSONParsing,o=this.responseType==="json";if(t&&_.isString(t)&&(n&&!this.responseType||o)){const s=!(e&&e.silentJSONParsing)&&o;try{return JSON.parse(t)}catch(r){if(s)throw r.name==="SyntaxError"?D.from(r,D.ERR_BAD_RESPONSE,this,null,this.response):r}}return t}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:ce.classes.FormData,Blob:ce.classes.Blob},validateStatus:function(t){return t>=200&&t<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};_.forEach(["delete","get","head","post","put","patch"],t=>{Kt.headers[t]={}});const Ht=Kt,fi=_.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),hi=t=>{const e={};let n,o,s;return t&&t.split(`
`).forEach(function(r){s=r.indexOf(":"),n=r.substring(0,s).trim().toLowerCase(),o=r.substring(s+1).trim(),!(!n||e[n]&&fi[n])&&(n==="set-cookie"?e[n]?e[n].push(o):e[n]=[o]:e[n]=e[n]?e[n]+", "+o:o)}),e},un=Symbol("internals");function Ne(t){return t&&String(t).trim().toLowerCase()}function Xe(t){return t===!1||t==null?t:_.isArray(t)?t.map(Xe):String(t)}function di(t){const e=Object.create(null),n=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let o;for(;o=n.exec(t);)e[o[1]]=o[2];return e}const pi=t=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(t.trim());function mt(t,e,n,o,s){if(_.isFunction(o))return o.call(this,e,n);if(s&&(e=n),!!_.isString(e)){if(_.isString(o))return e.indexOf(o)!==-1;if(_.isRegExp(o))return o.test(e)}}function mi(t){return t.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,n,o)=>n.toUpperCase()+o)}function gi(t,e){const n=_.toCamelCase(" "+e);["get","set","has"].forEach(o=>{Object.defineProperty(t,o+n,{value:function(s,r,i){return this[o].call(this,e,s,r,i)},configurable:!0})})}let rt=class{constructor(t){t&&this.set(t)}set(t,e,n){const o=this;function s(i,a,l){const u=Ne(a);if(!u)throw new Error("header name must be a non-empty string");const c=_.findKey(o,u);(!c||o[c]===void 0||l===!0||l===void 0&&o[c]!==!1)&&(o[c||a]=Xe(i))}const r=(i,a)=>_.forEach(i,(l,u)=>s(l,u,a));return _.isPlainObject(t)||t instanceof this.constructor?r(t,e):_.isString(t)&&(t=t.trim())&&!pi(t)?r(hi(t),e):t!=null&&s(e,t,n),this}get(t,e){if(t=Ne(t),t){const n=_.findKey(this,t);if(n){const o=this[n];if(!e)return o;if(e===!0)return di(o);if(_.isFunction(e))return e.call(this,o,n);if(_.isRegExp(e))return e.exec(o);throw new TypeError("parser must be boolean|regexp|function")}}}has(t,e){if(t=Ne(t),t){const n=_.findKey(this,t);return!!(n&&this[n]!==void 0&&(!e||mt(this,this[n],n,e)))}return!1}delete(t,e){const n=this;let o=!1;function s(r){if(r=Ne(r),r){const i=_.findKey(n,r);i&&(!e||mt(n,n[i],i,e))&&(delete n[i],o=!0)}}return _.isArray(t)?t.forEach(s):s(t),o}clear(t){const e=Object.keys(this);let n=e.length,o=!1;for(;n--;){const s=e[n];(!t||mt(this,this[s],s,t,!0))&&(delete this[s],o=!0)}return o}normalize(t){const e=this,n={};return _.forEach(this,(o,s)=>{const r=_.findKey(n,s);if(r){e[r]=Xe(o),delete e[s];return}const i=t?mi(s):String(s).trim();i!==s&&delete e[s],e[i]=Xe(o),n[i]=!0}),this}concat(...t){return this.constructor.concat(this,...t)}toJSON(t){const e=Object.create(null);return _.forEach(this,(n,o)=>{n!=null&&n!==!1&&(e[o]=t&&_.isArray(n)?n.join(", "):n)}),e}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([t,e])=>t+": "+e).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(t){return t instanceof this?t:new this(t)}static concat(t,...e){const n=new this(t);return e.forEach(o=>n.set(o)),n}static accessor(t){const e=(this[un]=this[un]={accessors:{}}).accessors,n=this.prototype;function o(s){const r=Ne(s);e[r]||(gi(n,s),e[r]=!0)}return _.isArray(t)?t.forEach(o):o(t),this}};rt.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);_.reduceDescriptors(rt.prototype,({value:t},e)=>{let n=e[0].toUpperCase()+e.slice(1);return{get:()=>t,set(o){this[n]=o}}});_.freezeMethods(rt);const de=rt;function gt(t,e){const n=this||Ht,o=e||n,s=de.from(o.headers);let r=o.data;return _.forEach(t,function(i){r=i.call(n,r,s.normalize(),e?e.status:void 0)}),s.normalize(),r}function Io(t){return!!(t&&t.__CANCEL__)}function Ke(t,e,n){D.call(this,t??"canceled",D.ERR_CANCELED,e,n),this.name="CanceledError"}_.inherits(Ke,D,{__CANCEL__:!0});function bi(t,e,n){const o=n.config.validateStatus;!n.status||!o||o(n.status)?t(n):e(new D("Request failed with status code "+n.status,[D.ERR_BAD_REQUEST,D.ERR_BAD_RESPONSE][Math.floor(n.status/100)-4],n.config,n.request,n))}const _i=ce.hasStandardBrowserEnv?{write(t,e,n,o,s,r){const i=[t+"="+encodeURIComponent(e)];_.isNumber(n)&&i.push("expires="+new Date(n).toGMTString()),_.isString(o)&&i.push("path="+o),_.isString(s)&&i.push("domain="+s),r===!0&&i.push("secure"),document.cookie=i.join("; ")},read(t){const e=document.cookie.match(new RegExp("(^|;\\s*)("+t+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove(t){this.write(t,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function yi(t){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(t)}function wi(t,e){return e?t.replace(/\/+$/,"")+"/"+e.replace(/^\/+/,""):t}function No(t,e){return t&&!yi(e)?wi(t,e):e}const ki=ce.hasStandardBrowserEnv?function(){const t=/(msie|trident)/i.test(navigator.userAgent),e=document.createElement("a");let n;function o(s){let r=s;return t&&(e.setAttribute("href",r),r=e.href),e.setAttribute("href",r),{href:e.href,protocol:e.protocol?e.protocol.replace(/:$/,""):"",host:e.host,search:e.search?e.search.replace(/^\?/,""):"",hash:e.hash?e.hash.replace(/^#/,""):"",hostname:e.hostname,port:e.port,pathname:e.pathname.charAt(0)==="/"?e.pathname:"/"+e.pathname}}return n=o(window.location.href),function(s){const r=_.isString(s)?o(s):s;return r.protocol===n.protocol&&r.host===n.host}}():function(){return function(){return!0}}();function Si(t){const e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(t);return e&&e[1]||""}function Ei(t,e){t=t||10;const n=new Array(t),o=new Array(t);let s=0,r=0,i;return e=e!==void 0?e:1e3,function(a){const l=Date.now(),u=o[r];i||(i=l),n[s]=a,o[s]=l;let c=r,f=0;for(;c!==s;)f+=n[c++],c=c%t;if(s=(s+1)%t,s===r&&(r=(r+1)%t),l-i<e)return;const g=u&&l-u;return g?Math.round(f*1e3/g):void 0}}function fn(t,e){let n=0;const o=Ei(50,250);return s=>{const r=s.loaded,i=s.lengthComputable?s.total:void 0,a=r-n,l=o(a),u=r<=i;n=r;const c={loaded:r,total:i,progress:i?r/i:void 0,bytes:a,rate:l||void 0,estimated:l&&i&&u?(i-r)/l:void 0,event:s};c[e?"download":"upload"]=!0,t(c)}}const Ti=typeof XMLHttpRequest<"u",vi=Ti&&function(t){return new Promise(function(e,n){let o=t.data;const s=de.from(t.headers).normalize();let{responseType:r,withXSRFToken:i}=t,a;function l(){t.cancelToken&&t.cancelToken.unsubscribe(a),t.signal&&t.signal.removeEventListener("abort",a)}let u;if(_.isFormData(o)){if(ce.hasStandardBrowserEnv||ce.hasStandardBrowserWebWorkerEnv)s.setContentType(!1);else if((u=s.getContentType())!==!1){const[h,...b]=u?u.split(";").map(p=>p.trim()).filter(Boolean):[];s.setContentType([h||"multipart/form-data",...b].join("; "))}}let c=new XMLHttpRequest;if(t.auth){const h=t.auth.username||"",b=t.auth.password?unescape(encodeURIComponent(t.auth.password)):"";s.set("Authorization","Basic "+btoa(h+":"+b))}const f=No(t.baseURL,t.url);c.open(t.method.toUpperCase(),Co(f,t.params,t.paramsSerializer),!0),c.timeout=t.timeout;function g(){if(!c)return;const h=de.from("getAllResponseHeaders"in c&&c.getAllResponseHeaders()),b={data:!r||r==="text"||r==="json"?c.responseText:c.response,status:c.status,statusText:c.statusText,headers:h,config:t,request:c};bi(function(p){e(p),l()},function(p){n(p),l()},b),c=null}if("onloadend"in c?c.onloadend=g:c.onreadystatechange=function(){!c||c.readyState!==4||c.status===0&&!(c.responseURL&&c.responseURL.indexOf("file:")===0)||setTimeout(g)},c.onabort=function(){c&&(n(new D("Request aborted",D.ECONNABORTED,t,c)),c=null)},c.onerror=function(){n(new D("Network Error",D.ERR_NETWORK,t,c)),c=null},c.ontimeout=function(){let h=t.timeout?"timeout of "+t.timeout+"ms exceeded":"timeout exceeded";const b=t.transitional||Bo;t.timeoutErrorMessage&&(h=t.timeoutErrorMessage),n(new D(h,b.clarifyTimeoutError?D.ETIMEDOUT:D.ECONNABORTED,t,c)),c=null},ce.hasStandardBrowserEnv&&(i&&_.isFunction(i)&&(i=i(t)),i||i!==!1&&ki(f))){const h=t.xsrfHeaderName&&t.xsrfCookieName&&_i.read(t.xsrfCookieName);h&&s.set(t.xsrfHeaderName,h)}o===void 0&&s.setContentType(null),"setRequestHeader"in c&&_.forEach(s.toJSON(),function(h,b){c.setRequestHeader(b,h)}),_.isUndefined(t.withCredentials)||(c.withCredentials=!!t.withCredentials),r&&r!=="json"&&(c.responseType=t.responseType),typeof t.onDownloadProgress=="function"&&c.addEventListener("progress",fn(t.onDownloadProgress,!0)),typeof t.onUploadProgress=="function"&&c.upload&&c.upload.addEventListener("progress",fn(t.onUploadProgress)),(t.cancelToken||t.signal)&&(a=h=>{c&&(n(!h||h.type?new Ke(null,t,c):h),c.abort(),c=null)},t.cancelToken&&t.cancelToken.subscribe(a),t.signal&&(t.signal.aborted?a():t.signal.addEventListener("abort",a)));const d=Si(f);if(d&&ce.protocols.indexOf(d)===-1){n(new D("Unsupported protocol "+d+":",D.ERR_BAD_REQUEST,t));return}c.send(o||null)})},Ct={http:Xr,xhr:vi};_.forEach(Ct,(t,e)=>{if(t){try{Object.defineProperty(t,"name",{value:e})}catch{}Object.defineProperty(t,"adapterName",{value:e})}});const hn=t=>`- ${t}`,Ai=t=>_.isFunction(t)||t===null||t===!1,Ro={getAdapter:t=>{t=_.isArray(t)?t:[t];const{length:e}=t;let n,o;const s={};for(let r=0;r<e;r++){n=t[r];let i;if(o=n,!Ai(n)&&(o=Ct[(i=String(n)).toLowerCase()],o===void 0))throw new D(`Unknown adapter '${i}'`);if(o)break;s[i||"#"+r]=o}if(!o){const r=Object.entries(s).map(([a,l])=>`adapter ${a} `+(l===!1?"is not supported by the environment":"is not available in the build"));let i=e?r.length>1?`since :
`+r.map(hn).join(`
`):" "+hn(r[0]):"as no adapter specified";throw new D("There is no suitable adapter to dispatch the request "+i,"ERR_NOT_SUPPORT")}return o},adapters:Ct};function bt(t){if(t.cancelToken&&t.cancelToken.throwIfRequested(),t.signal&&t.signal.aborted)throw new Ke(null,t)}function dn(t){return bt(t),t.headers=de.from(t.headers),t.data=gt.call(t,t.transformRequest),["post","put","patch"].indexOf(t.method)!==-1&&t.headers.setContentType("application/x-www-form-urlencoded",!1),Ro.getAdapter(t.adapter||Ht.adapter)(t).then(function(e){return bt(t),e.data=gt.call(t,t.transformResponse,e),e.headers=de.from(e.headers),e},function(e){return Io(e)||(bt(t),e&&e.response&&(e.response.data=gt.call(t,t.transformResponse,e.response),e.response.headers=de.from(e.response.headers))),Promise.reject(e)})}const pn=t=>t instanceof de?t.toJSON():t;function Be(t,e){e=e||{};const n={};function o(u,c,f){return _.isPlainObject(u)&&_.isPlainObject(c)?_.merge.call({caseless:f},u,c):_.isPlainObject(c)?_.merge({},c):_.isArray(c)?c.slice():c}function s(u,c,f){if(_.isUndefined(c)){if(!_.isUndefined(u))return o(void 0,u,f)}else return o(u,c,f)}function r(u,c){if(!_.isUndefined(c))return o(void 0,c)}function i(u,c){if(_.isUndefined(c)){if(!_.isUndefined(u))return o(void 0,u)}else return o(void 0,c)}function a(u,c,f){if(f in e)return o(u,c);if(f in t)return o(void 0,u)}const l={url:r,method:r,data:r,baseURL:i,transformRequest:i,transformResponse:i,paramsSerializer:i,timeout:i,timeoutMessage:i,withCredentials:i,withXSRFToken:i,adapter:i,responseType:i,xsrfCookieName:i,xsrfHeaderName:i,onUploadProgress:i,onDownloadProgress:i,decompress:i,maxContentLength:i,maxBodyLength:i,beforeRedirect:i,transport:i,httpAgent:i,httpsAgent:i,cancelToken:i,socketPath:i,responseEncoding:i,validateStatus:a,headers:(u,c)=>s(pn(u),pn(c),!0)};return _.forEach(Object.keys(Object.assign({},t,e)),function(u){const c=l[u]||s,f=c(t[u],e[u],u);_.isUndefined(f)&&c!==a||(n[u]=f)}),n}const Mo="1.6.2",zt={};["object","boolean","number","function","string","symbol"].forEach((t,e)=>{zt[t]=function(n){return typeof n===t||"a"+(e<1?"n ":" ")+t}});const mn={};zt.transitional=function(t,e,n){function o(s,r){return"[Axios v"+Mo+"] Transitional option '"+s+"'"+r+(n?". "+n:"")}return(s,r,i)=>{if(t===!1)throw new D(o(r," has been removed"+(e?" in "+e:"")),D.ERR_DEPRECATED);return e&&!mn[r]&&(mn[r]=!0,console.warn(o(r," has been deprecated since v"+e+" and will be removed in the near future"))),t?t(s,r,i):!0}};function Oi(t,e,n){if(typeof t!="object")throw new D("options must be an object",D.ERR_BAD_OPTION_VALUE);const o=Object.keys(t);let s=o.length;for(;s-- >0;){const r=o[s],i=e[r];if(i){const a=t[r],l=a===void 0||i(a,r,t);if(l!==!0)throw new D("option "+r+" must be "+l,D.ERR_BAD_OPTION_VALUE);continue}if(n!==!0)throw new D("Unknown option "+r,D.ERR_BAD_OPTION)}}const Bt={assertOptions:Oi,validators:zt},pe=Bt.validators;let xe=class{constructor(t){this.defaults=t,this.interceptors={request:new cn,response:new cn}}request(t,e){typeof t=="string"?(e=e||{},e.url=t):e=t||{},e=Be(this.defaults,e);const{transitional:n,paramsSerializer:o,headers:s}=e;n!==void 0&&Bt.assertOptions(n,{silentJSONParsing:pe.transitional(pe.boolean),forcedJSONParsing:pe.transitional(pe.boolean),clarifyTimeoutError:pe.transitional(pe.boolean)},!1),o!=null&&(_.isFunction(o)?e.paramsSerializer={serialize:o}:Bt.assertOptions(o,{encode:pe.function,serialize:pe.function},!0)),e.method=(e.method||this.defaults.method||"get").toLowerCase();let r=s&&_.merge(s.common,s[e.method]);s&&_.forEach(["delete","get","head","post","put","patch","common"],d=>{delete s[d]}),e.headers=de.concat(r,s);const i=[];let a=!0;this.interceptors.request.forEach(function(d){typeof d.runWhen=="function"&&d.runWhen(e)===!1||(a=a&&d.synchronous,i.unshift(d.fulfilled,d.rejected))});const l=[];this.interceptors.response.forEach(function(d){l.push(d.fulfilled,d.rejected)});let u,c=0,f;if(!a){const d=[dn.bind(this),void 0];for(d.unshift.apply(d,i),d.push.apply(d,l),f=d.length,u=Promise.resolve(e);c<f;)u=u.then(d[c++],d[c++]);return u}f=i.length;let g=e;for(c=0;c<f;){const d=i[c++],h=i[c++];try{g=d(g)}catch(b){h.call(this,b);break}}try{u=dn.call(this,g)}catch(d){return Promise.reject(d)}for(c=0,f=l.length;c<f;)u=u.then(l[c++],l[c++]);return u}getUri(t){t=Be(this.defaults,t);const e=No(t.baseURL,t.url);return Co(e,t.params,t.paramsSerializer)}};_.forEach(["delete","get","head","options"],function(t){xe.prototype[t]=function(e,n){return this.request(Be(n||{},{method:t,url:e,data:(n||{}).data}))}});_.forEach(["post","put","patch"],function(t){function e(n){return function(o,s,r){return this.request(Be(r||{},{method:t,headers:n?{"Content-Type":"multipart/form-data"}:{},url:o,data:s}))}}xe.prototype[t]=e(),xe.prototype[t+"Form"]=e(!0)});const Qe=xe;let Pi=class jo{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let n;this.promise=new Promise(function(s){n=s});const o=this;this.promise.then(s=>{if(!o._listeners)return;let r=o._listeners.length;for(;r-- >0;)o._listeners[r](s);o._listeners=null}),this.promise.then=s=>{let r;const i=new Promise(a=>{o.subscribe(a),r=a}).then(s);return i.cancel=function(){o.unsubscribe(r)},i},e(function(s,r,i){o.reason||(o.reason=new Ke(s,r,i),n(o.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const n=this._listeners.indexOf(e);n!==-1&&this._listeners.splice(n,1)}static source(){let e;return{token:new jo(function(n){e=n}),cancel:e}}};const Ci=Pi;function Bi(t){return function(e){return t.apply(null,e)}}function Li(t){return _.isObject(t)&&t.isAxiosError===!0}const Lt={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(Lt).forEach(([t,e])=>{Lt[e]=t});const Di=Lt;function Fo(t){const e=new Qe(t),n=bo(Qe.prototype.request,e);return _.extend(n,Qe.prototype,e,{allOwnKeys:!0}),_.extend(n,e,null,{allOwnKeys:!0}),n.create=function(o){return Fo(Be(t,o))},n}const W=Fo(Ht);W.Axios=Qe;W.CanceledError=Ke;W.CancelToken=Ci;W.isCancel=Io;W.VERSION=Mo;W.toFormData=st;W.AxiosError=D;W.Cancel=W.CanceledError;W.all=function(t){return Promise.all(t)};W.spread=Bi;W.isAxiosError=Li;W.mergeConfig=Be;W.AxiosHeaders=de;W.formToJSON=t=>Do(_.isHTMLForm(t)?new FormData(t):t);W.getAdapter=Ro.getAdapter;W.HttpStatusCode=Di;W.default=W;const Uo=W,{Axios:Nc,AxiosError:Rc,CanceledError:Mc,isCancel:jc,CancelToken:Fc,VERSION:Uc,all:qc,Cancel:Wc,isAxiosError:Kc,spread:Hc,toFormData:zc,AxiosHeaders:Gc,HttpStatusCode:ze,formToJSON:Vc,getAdapter:Jc,mergeConfig:Yc}=Uo;var Ae=null;typeof WebSocket<"u"?Ae=WebSocket:typeof MozWebSocket<"u"?Ae=MozWebSocket:typeof global<"u"?Ae=global.WebSocket||global.MozWebSocket:typeof window<"u"?Ae=window.WebSocket||window.MozWebSocket:typeof self<"u"&&(Ae=self.WebSocket||self.MozWebSocket);const Ii=Ae,_t={SCHEMA_DIR_RELATIVE_PATH:"./../schemas/",SCHEMA_FILENAME_PAYLOAD:"payload.schema.json",SCHEMA_FILENAME_RESPONSE:"response.schema.json",SIYUAN_DEFAULT_BASE_URL:"http://localhost:6806/",SIYUAN_DEFAULT_TOKEN:"",REQUEST_TIMEOUT:6e4};var gn,bn,_n,yn,wn;const Dt=class m{constructor(e={},n="xhr"){he(this,"_type","xhr"),he(this,"_baseURL",((bn=(gn=globalThis.top)==null?void 0:gn.document)==null?void 0:bn.baseURI)??((yn=(_n=globalThis.parent)==null?void 0:_n.document)==null?void 0:yn.baseURI)??((wn=globalThis.location)==null?void 0:wn.origin)??_t.SIYUAN_DEFAULT_BASE_URL),he(this,"_token",_t.SIYUAN_DEFAULT_TOKEN),he(this,"_axios",Uo.create({baseURL:this._baseURL,timeout:_t.REQUEST_TIMEOUT,headers:{Authorization:`Token ${this._token}`}})),he(this,"_fetch",hr.create({baseURL:this._baseURL,headers:{Authorization:`Token ${this._token}`}})),this._setClientType(n),this._updateOptions(e,n)}static headers2record(e){const n={};return e.forEach((o,s)=>{n[s]=o}),n}static entries2record(e){const n={};for(const[o,s]of e)n[o]=s;return n}_setClientType(e){this._type=e}_updateOptions(e,n=this._type){switch(this._token=e.token??this._token,this._baseURL=e.baseURL??this._baseURL,n){case"fetch":const o=e;if(o.token){const s="Authorization",r=`Token ${e.token}`;Array.isArray(o.headers)?o.headers.push([s,r]):o.headers instanceof Headers?o.headers.set(s,r):typeof o.headers=="object"?o.headers[s]=r:o.headers={[s]:r},delete e.token}this._fetch=this._fetch.create(o);break;case"xhr":default:for(const[s,r]of Object.entries(e))switch(s){case"token":this._axios.defaults.headers.Authorization=`Token ${this._token}`;break;default:this._axios.defaults[s]=r;break}break}this._baseURL=e.baseURL??this._baseURL}broadcast(e,n,o){const s=(o==null?void 0:o.baseURL)??this._baseURL,r=(o==null?void 0:o.token)??this._token,i=new URLSearchParams(e);r&&i.set("token",r);const a=new URL(s);return a.protocol=a.protocol.replace(/^http/,"ws"),a.pathname=a.pathname.endsWith("/")?`${a.pathname}${m.ws.broadcast.pathname.substring(1)}`:`${a.pathname}${m.ws.broadcast.pathname}`,a.search=i.toString(),new Ii(a,n)}async upload(e,n){const o=new FormData;return o.append("assetsDirPath",e.assetsDirPath??"/assets/"),e.files.forEach(s=>o.append("file[]",s)),await this._request(m.api.asset.upload.pathname,m.api.asset.upload.method,o,n)}async getBlockAttrs(e,n){return await this._request(m.api.attr.getBlockAttrs.pathname,m.api.attr.getBlockAttrs.method,e,n)}async getBookmarkLabels(e){return await this._request(m.api.attr.getBookmarkLabels.pathname,m.api.attr.getBookmarkLabels.method,void 0,e)}async setBlockAttrs(e,n){return await this._request(m.api.attr.setBlockAttrs.pathname,m.api.attr.setBlockAttrs.method,e,n)}async appendBlock(e,n){return await this._request(m.api.block.appendBlock.pathname,m.api.block.appendBlock.method,e,n)}async deleteBlock(e,n){return await this._request(m.api.block.deleteBlock.pathname,m.api.block.deleteBlock.method,e,n)}async getBlockBreadcrumb(e,n){return await this._request(m.api.block.getBlockBreadcrumb.pathname,m.api.block.getBlockBreadcrumb.method,e,n)}async getBlockDOM(e,n){return await this._request(m.api.block.getBlockDOM.pathname,m.api.block.getBlockDOM.method,e,n)}async getBlockInfo(e,n){return await this._request(m.api.block.getBlockInfo.pathname,m.api.block.getBlockInfo.method,e,n)}async getBlockKramdown(e,n){return await this._request(m.api.block.getBlockKramdown.pathname,m.api.block.getBlockKramdown.method,e,n)}async getChildBlocks(e,n){return await this._request(m.api.block.getChildBlocks.pathname,m.api.block.getChildBlocks.method,e,n)}async getDocInfo(e,n){return await this._request(m.api.block.getDocInfo.pathname,m.api.block.getDocInfo.method,e,n)}async insertBlock(e,n){return await this._request(m.api.block.insertBlock.pathname,m.api.block.insertBlock.method,e,n)}async moveBlock(e,n){return await this._request(m.api.block.moveBlock.pathname,m.api.block.moveBlock.method,e,n)}async prependBlock(e,n){return await this._request(m.api.block.prependBlock.pathname,m.api.block.prependBlock.method,e,n)}async transferBlockRef(e,n){return await this._request(m.api.block.transferBlockRef.pathname,m.api.block.transferBlockRef.method,e,n)}async updateBlock(e,n){return await this._request(m.api.block.updateBlock.pathname,m.api.block.updateBlock.method,e,n)}async getChannelInfo(e,n){return await this._request(m.api.broadcast.getChannelInfo.pathname,m.api.broadcast.getChannelInfo.method,e,n)}async getChannels(e){return await this._request(m.api.broadcast.getChannels.pathname,m.api.broadcast.getChannels.method,void 0,e)}async postMessage(e,n){return await this._request(m.api.broadcast.postMessage.pathname,m.api.broadcast.postMessage.method,e,n)}async pandoc(e,n){return await this._request(m.api.convert.pandoc.pathname,m.api.convert.pandoc.method,e,n)}async exportResources(e,n){return await this._request(m.api.export.exportResources.pathname,m.api.export.exportResources.method,e,n)}async exportMdContent(e,n){return await this._request(m.api.export.exportMdContent.pathname,m.api.export.exportMdContent.method,e,n)}async getFile(e,n="text",o){return await this._request(m.api.file.getFile.pathname,m.api.file.getFile.method,e,o,!1,n)}async putFile(e,n){e.file!==void 0&&!(e.file instanceof File)&&(e.file=new File([e.file],e.path.split("/").pop()));const o=new FormData;for(const[s,r]of Object.entries(e))e.hasOwnProperty(s)&&(r instanceof Blob?o.append(s,r):o.append(s,String(r)));return await this._request(m.api.file.putFile.pathname,m.api.file.putFile.method,o,n)}async readDir(e,n){return await this._request(m.api.file.readDir.pathname,m.api.file.readDir.method,e,n)}async removeFile(e,n){return await this._request(m.api.file.removeFile.pathname,m.api.file.removeFile.method,e,n)}async renameFile(e,n){return await this._request(m.api.file.renameFile.pathname,m.api.file.renameFile.method,e,n)}async createDocWithMd(e,n){return await this._request(m.api.filetree.createDocWithMd.pathname,m.api.filetree.createDocWithMd.method,e,n)}async getDoc(e,n){return await this._request(m.api.filetree.getDoc.pathname,m.api.filetree.getDoc.method,e,n)}async getHPathByID(e,n){return await this._request(m.api.filetree.getHPathByID.pathname,m.api.filetree.getHPathByID.method,e,n)}async getHPathByPath(e,n){return await this._request(m.api.filetree.getHPathByPath.pathname,m.api.filetree.getHPathByPath.method,e,n)}async getIDsByHPath(e,n){return await this._request(m.api.filetree.getIDsByHPath.pathname,m.api.filetree.getIDsByHPath.method,e,n)}async listDocsByPath(e,n){return await this._request(m.api.filetree.listDocsByPath.pathname,m.api.filetree.listDocsByPath.method,e,n)}async moveDocs(e,n){return await this._request(m.api.filetree.moveDocs.pathname,m.api.filetree.moveDocs.method,e,n)}async removeDoc(e,n){return await this._request(m.api.filetree.removeDoc.pathname,m.api.filetree.removeDoc.method,e,n)}async renameDoc(e,n){return await this._request(m.api.filetree.renameDoc.pathname,m.api.filetree.renameDoc.method,e,n)}async searchDocs(e,n){return await this._request(m.api.filetree.searchDocs.pathname,m.api.filetree.searchDocs.method,e,n)}async getDocHistoryContent(e,n){return await this._request(m.api.history.getDocHistoryContent.pathname,m.api.history.getDocHistoryContent.method,e,n)}async getHistoryItems(e,n){return await this._request(m.api.history.getHistoryItems.pathname,m.api.history.getHistoryItems.method,e,n)}async getShorthand(e,n){return await this._request(m.api.inbox.getShorthand.pathname,m.api.inbox.getShorthand.method,e,n)}async echo(e,n){if(e)switch(n??(n={type:this._type}),n==null?void 0:n.type){case"fetch":{const o={};e.headers&&(o.headers=e.headers),e.query&&(o.query=m.entries2record(e.query.entries())),n.options?Object.assign(o,n.options):n.options=o;break}case"xhr":{const o={};e.headers&&(o.headers=Array.isArray(e.headers)?m.entries2record(e.headers):e.headers instanceof Headers?m.headers2record(e.headers):e.headers),e.query&&(o.params=e.query),n.options?Object.assign(o,n.options):n.options=o;break}}return await this._request(m.api.network.echo.pathname,(e==null?void 0:e.method)??m.api.network.echo.method,e==null?void 0:e.body,n)}async forwardProxy(e,n){return await this._request(m.api.network.forwardProxy.pathname,m.api.network.forwardProxy.method,e,n)}async closeNotebook(e,n){return await this._request(m.api.notebook.closeNotebook.pathname,m.api.notebook.closeNotebook.method,e,n)}async createNotebook(e,n){return await this._request(m.api.notebook.createNotebook.pathname,m.api.notebook.createNotebook.method,e,n)}async getNotebookConf(e,n){return await this._request(m.api.notebook.getNotebookConf.pathname,m.api.notebook.getNotebookConf.method,e,n)}async lsNotebooks(e){return await this._request(m.api.notebook.lsNotebooks.pathname,m.api.notebook.lsNotebooks.method,void 0,e)}async openNotebook(e,n){return await this._request(m.api.notebook.openNotebook.pathname,m.api.notebook.openNotebook.method,e,n)}async removeNotebook(e,n){return await this._request(m.api.notebook.removeNotebook.pathname,m.api.notebook.removeNotebook.method,e,n)}async renameNotebook(e,n){return await this._request(m.api.notebook.renameNotebook.pathname,m.api.notebook.renameNotebook.method,e,n)}async setNotebookConf(e,n){return await this._request(m.api.notebook.setNotebookConf.pathname,m.api.notebook.setNotebookConf.method,e,n)}async pushErrMsg(e,n){return await this._request(m.api.notification.pushErrMsg.pathname,m.api.notification.pushErrMsg.method,e,n)}async pushMsg(e,n){return await this._request(m.api.notification.pushMsg.pathname,m.api.notification.pushMsg.method,e,n)}async sql(e,n){return await this._request(m.api.query.sql.pathname,m.api.query.sql.method,e,n)}async openRepoSnapshotDoc(e,n){return await this._request(m.api.repo.openRepoSnapshotDoc.pathname,m.api.repo.openRepoSnapshotDoc.method,e,n)}async fullTextSearchBlock(e,n){return await this._request(m.api.search.fullTextSearchBlock.pathname,m.api.search.fullTextSearchBlock.method,e,n)}async getSnippet(e,n){return await this._request(m.api.snippet.getSnippet.pathname,m.api.snippet.getSnippet.method,e,n)}async setSnippet(e,n){return await this._request(m.api.snippet.setSnippet.pathname,m.api.snippet.setSnippet.method,e,n)}async getLocalStorage(e){return await this._request(m.api.storage.getLocalStorage.pathname,m.api.storage.getLocalStorage.method,void 0,e)}async getRecentDocs(e){return await this._request(m.api.storage.getRecentDocs.pathname,m.api.storage.getRecentDocs.method,void 0,e)}async setLocalStorage(e,n){return await this._request(m.api.storage.setLocalStorage.pathname,m.api.storage.setLocalStorage.method,e,n)}async setLocalStorageVal(e,n){return await this._request(m.api.storage.setLocalStorageVal.pathname,m.api.storage.setLocalStorageVal.method,e,n)}async bootProgress(e){return await this._request(m.api.system.bootProgress.pathname,m.api.system.bootProgress.method,void 0,e)}async getConf(e){return await this._request(m.api.system.getConf.pathname,m.api.system.getConf.method,void 0,e)}async currentTime(e){return await this._request(m.api.system.currentTime.pathname,m.api.system.currentTime.method,void 0,e)}async version(e){return await this._request(m.api.system.version.pathname,m.api.system.version.method,void 0,e)}async render(e,n){return await this._request(m.api.template.render.pathname,m.api.template.render.method,e,n)}async renderSprig(e,n){return await this._request(m.api.template.renderSprig.pathname,m.api.template.renderSprig.method,e,n)}async _request(e,n,o,s,r=!0,i="json"){try{switch((s==null?void 0:s.type)??this._type){case"fetch":{const a=s==null?void 0:s.options;i=(()=>{switch(i){case"arraybuffer":return"arrayBuffer";case"document":return"text";default:return i}})();const l=await this._fetch(e,{method:n,body:o,responseType:i,onResponse:async u=>{switch(u.response.status){case ze.Ok:switch(i){case"blob":u.response._data.contentType=u.response.headers.get("content-type");break;default:break}break;case ze.Accepted:e===m.api.file.getFile.pathname&&this._parseFetchResponse(u.response._data);break;default:break}},...a});return r&&i==="json"&&typeof l=="object"?this._parseFetchResponse(l):l}case"xhr":default:{const a=s==null?void 0:s.options;i=(()=>{switch(i){case"arrayBuffer":return"arraybuffer";default:return i}})();const l=await this._axios.request({url:e,method:n,data:o,responseType:i,...a});switch(l.status){case ze.Ok:if(r&&i==="json"&&typeof l.data=="object")return this._parseAxiosResponse(l);switch(i){case"blob":l.data.contentType=l.headers.getContentType();break;default:break}return l.data;case ze.Accepted:return e===m.api.file.getFile.pathname?this._parseAxiosResponse(l):l.data;default:throw new dr(l)}}}}catch(a){throw a}}_parseFetchResponse(e){if(e.code===0)return e;throw new nn(e)}_parseAxiosResponse(e){if(e.data.code===0)return e.data;throw new nn(e.data,e)}};he(Dt,"ws",{broadcast:{pathname:"/ws/broadcast"}}),he(Dt,"api",{asset:{upload:{pathname:"/api/asset/upload",method:"POST"}},attr:{getBlockAttrs:{pathname:"/api/attr/getBlockAttrs",method:"POST"},getBookmarkLabels:{pathname:"/api/attr/getBookmarkLabels",method:"POST"},setBlockAttrs:{pathname:"/api/attr/setBlockAttrs",method:"POST"}},block:{appendBlock:{pathname:"/api/block/appendBlock",method:"POST"},deleteBlock:{pathname:"/api/block/deleteBlock",method:"POST"},getBlockBreadcrumb:{pathname:"/api/block/getBlockBreadcrumb",method:"POST"},getBlockDOM:{pathname:"/api/block/getBlockDOM",method:"POST"},getBlockInfo:{pathname:"/api/block/getBlockInfo",method:"POST"},getBlockKramdown:{pathname:"/api/block/getBlockKramdown",method:"POST"},getChildBlocks:{pathname:"/api/block/getChildBlocks",method:"POST"},getDocInfo:{pathname:"/api/block/getDocInfo",method:"POST"},insertBlock:{pathname:"/api/block/insertBlock",method:"POST"},moveBlock:{pathname:"/api/block/moveBlock",method:"POST"},prependBlock:{pathname:"/api/block/prependBlock",method:"POST"},transferBlockRef:{pathname:"/api/block/transferBlockRef",method:"POST"},updateBlock:{pathname:"/api/block/updateBlock",method:"POST"}},broadcast:{getChannelInfo:{pathname:"/api/broadcast/getChannelInfo",method:"POST"},getChannels:{pathname:"/api/broadcast/getChannels",method:"POST"},postMessage:{pathname:"/api/broadcast/postMessage",method:"POST"}},convert:{pandoc:{pathname:"/api/convert/pandoc",method:"POST"}},export:{exportMdContent:{pathname:"/api/export/exportMdContent",method:"POST"},exportResources:{pathname:"/api/export/exportResources",method:"POST"}},file:{getFile:{pathname:"/api/file/getFile",method:"POST"},putFile:{pathname:"/api/file/putFile",method:"POST"},readDir:{pathname:"/api/file/readDir",method:"POST"},removeFile:{pathname:"/api/file/removeFile",method:"POST"},renameFile:{pathname:"/api/file/renameFile",method:"POST"}},filetree:{createDocWithMd:{pathname:"/api/filetree/createDocWithMd",method:"POST"},getDoc:{pathname:"/api/filetree/getDoc",method:"POST"},getHPathByID:{pathname:"/api/filetree/getHPathByID",method:"POST"},getHPathByPath:{pathname:"/api/filetree/getHPathByPath",method:"POST"},getIDsByHPath:{pathname:"/api/filetree/getIDsByHPath",method:"POST"},listDocsByPath:{pathname:"/api/filetree/listDocsByPath",method:"POST"},moveDocs:{pathname:"/api/filetree/moveDocs",method:"POST"},removeDoc:{pathname:"/api/filetree/removeDoc",method:"POST"},renameDoc:{pathname:"/api/filetree/renameDoc",method:"POST"},searchDocs:{pathname:"/api/filetree/searchDocs",method:"POST"}},history:{getDocHistoryContent:{pathname:"/api/history/getDocHistoryContent",method:"POST"},getHistoryItems:{pathname:"/api/history/getHistoryItems",method:"POST"}},inbox:{getShorthand:{pathname:"/api/inbox/getShorthand",method:"POST"}},network:{echo:{pathname:"/api/network/echo",method:"POST"},forwardProxy:{pathname:"/api/network/forwardProxy",method:"POST"}},notebook:{closeNotebook:{pathname:"/api/notebook/closeNotebook",method:"POST"},createNotebook:{pathname:"/api/notebook/createNotebook",method:"POST"},getNotebookConf:{pathname:"/api/notebook/getNotebookConf",method:"POST"},lsNotebooks:{pathname:"/api/notebook/lsNotebooks",method:"POST"},openNotebook:{pathname:"/api/notebook/openNotebook",method:"POST"},removeNotebook:{pathname:"/api/notebook/removeNotebook",method:"POST"},renameNotebook:{pathname:"/api/notebook/renameNotebook",method:"POST"},setNotebookConf:{pathname:"/api/notebook/setNotebookConf",method:"POST"}},notification:{pushErrMsg:{pathname:"/api/notification/pushErrMsg",method:"POST"},pushMsg:{pathname:"/api/notification/pushMsg",method:"POST"}},query:{sql:{pathname:"/api/query/sql",method:"POST"}},repo:{openRepoSnapshotDoc:{pathname:"/api/repo/openRepoSnapshotDoc",method:"POST"}},search:{fullTextSearchBlock:{pathname:"/api/search/fullTextSearchBlock",method:"POST"}},snippet:{getSnippet:{pathname:"/api/snippet/getSnippet",method:"POST"},setSnippet:{pathname:"/api/snippet/setSnippet",method:"POST"}},storage:{getLocalStorage:{pathname:"/api/storage/getLocalStorage",method:"POST"},getRecentDocs:{pathname:"/api/storage/getRecentDocs",method:"POST"},setLocalStorage:{pathname:"/api/storage/setLocalStorage",method:"POST"},setLocalStorageVal:{pathname:"/api/storage/setLocalStorageVal",method:"POST"}},system:{bootProgress:{pathname:"/api/system/bootProgress",method:"POST"},currentTime:{pathname:"/api/system/currentTime",method:"POST"},getConf:{pathname:"/api/system/getConf",method:"POST"},version:{pathname:"/api/system/version",method:"POST"}},template:{render:{pathname:"/api/template/render",method:"POST"},renderSprig:{pathname:"/api/template/renderSprig",method:"POST"}}});let Ni=Dt;const Ri=`<symbol id="icon-keepass-keeweb"
    viewBox="0 0 512 512">
    <path d="M136.736 512c-4.892-.008-10.322-2.061-15.92-4.997-11.941-6.265-20.13-14.185-13.293-27.218l166.101-316.638c-1.972-1.022-3.619-1.88-4.743-2.469-59.892-31.418-86.463-77.87-64.952-118.877 24.726-47.135 101.304-55.69 171.042-19.107 69.738 36.584 106.227 104.451 81.501 151.586-21.264 40.536-76.784 44.151-132.61 14.866-1.538-.807-4.033-2.103-6.857-3.567L150.768 502.471c-3.632 6.924-8.488 9.538-14.032 9.529zm-30.582-67.835l-3.144-1.649-.7-.366-42.546-22.32v-.001l-10.256-5.38c-1.738-.911-2.407-3.057-1.496-4.794l13.465-25.667c.906-1.728 3.036-2.399 4.768-1.509l.028.013 20.513 10.761c1.736.911 3.883.241 4.794-1.496l13.466-25.667c.911-1.737.24-3.883-1.497-4.794l-10.256-5.382-10.256-5.38c-1.737-.911-2.406-3.057-1.495-4.794l13.464-25.669c.911-1.737 3.058-2.406 4.794-1.494l10.258 5.38 26.697 14.005 16.548 8.681c.007.003.014.007.021.011l3.125 1.639-14.142 26.957-.973 1.855c0 .001-.001.003-.002.004l-20.063 38.245-2.041 3.888-11.424 21.779c-.002.004-.005.009-.008.014zm67.232-128.162l-3.145-1.651-14.938-7.837-11.794-6.187c-1.737-.911-2.408-3.057-1.497-4.794l13.466-25.667c.911-1.737 3.058-2.408 4.794-1.497l11.795 6.188 14.939 7.837c.007.003.014.007.021.01l3.125 1.64-1.651 3.145-6.731 12.834-6.733 12.833c-.003.005-.006.008-.009.013zm219.778-151.914c8.857.016 15.784-3.552 20.386-12.326 14.027-26.737-11.92-67.987-57.953-92.135-46.032-24.148-94.719-22.049-108.746 4.688-14.026 26.737 24.987 44.293 71.02 68.441 30.928 16.224 57.156 31.296 75.293 31.332z"/>
</symbol>
`,Mi=`<symbol id="icon-keepass-slash" viewBox="0 0 1024 1024">
    <path
        d="M478.912 912.384L685.44 133.888A55.68 55.68 0 0 0 631.68 64h-23.168a64 64 0 0 0-61.824 47.488L338.88 889.344A56.192 56.192 0 0 0 393.152 960h23.936a64 64 0 0 0 61.824-47.616z"
    />
</symbol>
`;function K(){}function it(t,e){for(const n in e)t[n]=e[n];return t}function qo(t){return t()}function kn(){return Object.create(null)}function Z(t){t.forEach(qo)}function Gt(t){return typeof t=="function"}function z(t,e){return t!=t?e==e:t!==e||t&&typeof t=="object"||typeof t=="function"}let Ge;function Sn(t,e){return t===e?!0:(Ge||(Ge=document.createElement("a")),Ge.href=e,t===Ge.href)}function ji(t){return Object.keys(t).length===0}function Fi(t,...e){if(t==null){for(const o of e)o(void 0);return K}const n=t.subscribe(...e);return n.unsubscribe?()=>n.unsubscribe():n}function Ui(t){let e;return Fi(t,n=>e=n)(),e}function J(t,e,n,o){if(t){const s=Wo(t,e,n,o);return t[0](s)}}function Wo(t,e,n,o){return t[1]&&o?it(n.ctx.slice(),t[1](o(e))):n.ctx}function Y(t,e,n,o){if(t[2]&&o){const s=t[2](o(n));if(e.dirty===void 0)return s;if(typeof s=="object"){const r=[],i=Math.max(e.dirty.length,s.length);for(let a=0;a<i;a+=1)r[a]=e.dirty[a]|s[a];return r}return e.dirty|s}return e.dirty}function X(t,e,n,o,s,r){if(s){const i=Wo(e,n,o,r);t.p(i,s)}}function Q(t){if(t.ctx.length>32){const e=[],n=t.ctx.length/32;for(let o=0;o<n;o++)e[o]=-1;return e}return-1}function qi(t){const e={};for(const n in t)e[n]=!0;return e}function Wi(t){return t&&Gt(t.destroy)?t.destroy:K}function L(t,e){t.appendChild(e)}function A(t,e,n){t.insertBefore(e,n||null)}function v(t){t.parentNode&&t.parentNode.removeChild(t)}function P(t){return document.createElement(t)}function It(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}function ye(t){return document.createTextNode(t)}function j(){return ye(" ")}function te(){return ye("")}function F(t,e,n,o){return t.addEventListener(e,n,o),()=>t.removeEventListener(e,n,o)}function y(t,e,n){n==null?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}const Ki=["width","height"];function Hi(t,e){const n=Object.getOwnPropertyDescriptors(t.__proto__);for(const o in e)e[o]==null?t.removeAttribute(o):o==="style"?t.style.cssText=e[o]:o==="__value"?t.value=t[o]=e[o]:n[o]&&n[o].set&&Ki.indexOf(o)===-1?t[o]=e[o]:y(t,o,e[o])}function zi(t,e){Object.keys(e).forEach(n=>{Gi(t,n,e[n])})}function Gi(t,e,n){const o=e.toLowerCase();o in t?t[o]=typeof t[o]=="boolean"&&n===""?!0:n:e in t?t[e]=typeof t[e]=="boolean"&&n===""?!0:n:y(t,e,n)}function En(t){return/-/.test(t)?zi:Hi}function Tn(t,e,n){t.setAttributeNS("http://www.w3.org/1999/xlink",e,n)}function Nt(t){return t===""?null:+t}function Vi(t){return Array.from(t.childNodes)}function Vt(t,e){e=""+e,t.data!==e&&(t.data=e)}function se(t,e){t.value=e??""}function Re(t,e,n,o){n==null?t.style.removeProperty(e):t.style.setProperty(e,n,o?"important":"")}function vn(t,e,n){for(let o=0;o<t.options.length;o+=1){const s=t.options[o];if(s.__value===e){s.selected=!0;return}}(!n||e!==void 0)&&(t.selectedIndex=-1)}function Ji(t){const e=t.querySelector(":checked");return e&&e.__value}function k(t,e,n){t.classList.toggle(e,!!n)}function Yi(t,e,{bubbles:n=!1,cancelable:o=!1}={}){return new CustomEvent(t,{detail:e,bubbles:n,cancelable:o})}class at{constructor(e=!1){B(this,"is_svg",!1);B(this,"e");B(this,"n");B(this,"t");B(this,"a");this.is_svg=e,this.e=this.n=null}c(e){this.h(e)}m(e,n,o=null){this.e||(this.is_svg?this.e=It(n.nodeName):this.e=P(n.nodeType===11?"TEMPLATE":n.nodeName),this.t=n.tagName!=="TEMPLATE"?n:n.content,this.c(e)),this.i(o)}h(e){this.e.innerHTML=e,this.n=Array.from(this.e.nodeName==="TEMPLATE"?this.e.content.childNodes:this.e.childNodes)}i(e){for(let n=0;n<this.n.length;n+=1)A(this.t,this.n[n],e)}p(e){this.d(),this.h(e),this.i(this.a)}d(){this.n.forEach(v)}}let Ue;function je(t){Ue=t}function Ko(){if(!Ue)throw new Error("Function called outside component initialization");return Ue}function Xi(t){Ko().$$.on_destroy.push(t)}function lt(){const t=Ko();return(e,n,{cancelable:o=!1}={})=>{const s=t.$$.callbacks[e];if(s){const r=Yi(e,n,{cancelable:o});return s.slice().forEach(i=>{i.call(t,r)}),!r.defaultPrevented}return!0}}function An(t,e){const n=t.$$.callbacks[e.type];n&&n.slice().forEach(o=>o.call(this,e))}const Oe=[],$e=[];let Pe=[];const On=[],Qi=Promise.resolve();let Rt=!1;function Zi(){Rt||(Rt=!0,Qi.then(Ho))}function et(t){Pe.push(t)}const yt=new Set;let Te=0;function Ho(){if(Te!==0)return;const t=Ue;do{try{for(;Te<Oe.length;){const e=Oe[Te];Te++,je(e),xi(e.$$)}}catch(e){throw Oe.length=0,Te=0,e}for(je(null),Oe.length=0,Te=0;$e.length;)$e.pop()();for(let e=0;e<Pe.length;e+=1){const n=Pe[e];yt.has(n)||(yt.add(n),n())}Pe.length=0}while(Oe.length);for(;On.length;)On.pop()();Rt=!1,yt.clear(),je(t)}function xi(t){if(t.fragment!==null){t.update(),Z(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(et)}}function $i(t){const e=[],n=[];Pe.forEach(o=>t.indexOf(o)===-1?e.push(o):n.push(o)),n.forEach(o=>o()),Pe=e}const Ze=new Set;let ke;function re(){ke={r:0,c:[],p:ke}}function ie(){ke.r||Z(ke.c),ke=ke.p}function w(t,e){t&&t.i&&(Ze.delete(t),t.i(e))}function S(t,e,n,o){if(t&&t.o){if(Ze.has(t))return;Ze.add(t),ke.c.push(()=>{Ze.delete(t),o&&(n&&t.d(1),o())}),t.o(e)}else o&&o()}function ue(t){return(t==null?void 0:t.length)!==void 0?t:Array.from(t)}function ea(t,e){t.d(1),e.delete(t.key)}function ct(t,e){S(t,1,1,()=>{e.delete(t.key)})}function He(t,e,n,o,s,r,i,a,l,u,c,f){let g=t.length,d=r.length,h=g;const b={};for(;h--;)b[t[h].key]=h;const p=[],C=new Map,G=new Map,ne=[];for(h=d;h--;){const E=f(s,r,h),H=n(E);let U=i.get(H);U?o&&ne.push(()=>U.p(E,e)):(U=u(H,E),U.c()),C.set(H,p[h]=U),H in b&&G.set(H,Math.abs(h-b[H]))}const T=new Set,M=new Set;function q(E){w(E,1),E.m(a,c),i.set(E.key,E),c=E.first,d--}for(;g&&d;){const E=p[d-1],H=t[g-1],U=E.key,Ee=H.key;E===H?(c=E.first,g--,d--):C.has(Ee)?!i.has(U)||T.has(U)?q(E):M.has(Ee)?g--:G.get(U)>G.get(Ee)?(M.add(U),q(E)):(T.add(Ee),g--):(l(H,i),g--)}for(;g--;){const E=t[g];C.has(E.key)||l(E,i)}for(;d;)q(p[d-1]);return Z(ne),p}function Jt(t,e){const n={},o={},s={$$scope:1};let r=t.length;for(;r--;){const i=t[r],a=e[r];if(a){for(const l in i)l in a||(o[l]=1);for(const l in a)s[l]||(n[l]=a[l],s[l]=1);t[r]=a}else for(const l in i)s[l]=1}for(const i in o)i in n||(n[i]=void 0);return n}function zo(t){return typeof t=="object"&&t!==null?t:{}}function R(t){t&&t.c()}function I(t,e,n){const{fragment:o,after_update:s}=t.$$;o&&o.m(e,n),et(()=>{const r=t.$$.on_mount.map(qo).filter(Gt);t.$$.on_destroy?t.$$.on_destroy.push(...r):Z(r),t.$$.on_mount=[]}),s.forEach(et)}function N(t,e){const n=t.$$;n.fragment!==null&&($i(n.after_update),Z(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function ta(t,e){t.$$.dirty[0]===-1&&(Oe.push(t),Zi(),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function x(t,e,n,o,s,r,i=null,a=[-1]){const l=Ue;je(t);const u=t.$$={fragment:null,ctx:[],props:r,update:K,not_equal:s,bound:kn(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(l?l.$$.context:[])),callbacks:kn(),dirty:a,skip_bound:!1,root:e.target||l.$$.root};i&&i(u.root);let c=!1;if(u.ctx=n?n(t,e.props||{},(f,g,...d)=>{const h=d.length?d[0]:g;return u.ctx&&s(u.ctx[f],u.ctx[f]=h)&&(!u.skip_bound&&u.bound[f]&&u.bound[f](h),c&&ta(t,f)),g}):[],u.update(),c=!0,Z(u.before_update),u.fragment=o?o(u.ctx):!1,e.target){if(e.hydrate){const f=Vi(e.target);u.fragment&&u.fragment.l(f),f.forEach(v)}else u.fragment&&u.fragment.c();e.intro&&w(t.$$.fragment),I(t,e.target,e.anchor),Ho()}je(l)}class ${constructor(){B(this,"$$");B(this,"$$set")}$destroy(){N(this,1),this.$destroy=K}$on(e,n){if(!Gt(n))return K;const o=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return o.push(n),()=>{const s=o.indexOf(n);s!==-1&&o.splice(s,1)}}$set(e){this.$$set&&!ji(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const na="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(na);const Pn={id:/^\d{14}-[0-9a-z]{7}$/,url:/^siyuan:\/\/blocks\/(\d{14}-[0-9a-z]{7})/,snippet:/^\d{14}-[0-9a-z]{7}$/,created:/^\d{10}$/,history:/[\/\\]history[\/\\]\d{4}-\d{2}-\d{2}-\d{6}-(clean|update|delete|format|sync|replace)([\/\\]\d{14}-[0-9a-z]{7})+\.sy$/,snapshot:/^[0-9a-f]{40}$/,shorthand:/^\d{13}$/};function oa(t){let e,n;return{c(){e=It("svg"),n=It("use"),Tn(n,"xlink:href",t[0]),y(e,"style",t[3]),y(e,"data-id",t[1]),y(e,"class",t[2]),k(e,"popover__block",Pn.id.test(t[1]))},m(o,s){A(o,e,s),L(e,n)},p(o,[s]){s&1&&Tn(n,"xlink:href",o[0]),s&8&&y(e,"style",o[3]),s&2&&y(e,"data-id",o[1]),s&4&&y(e,"class",o[2]),s&6&&k(e,"popover__block",Pn.id.test(o[1]))},i:K,o:K,d(o){o&&v(e)}}}function sa(t,e,n){let{icon:o}=e,{id:s=""}=e,{className:r=""}=e,{style:i=""}=e;return t.$$set=a=>{"icon"in a&&n(0,o=a.icon),"id"in a&&n(1,s=a.id),"className"in a&&n(2,r=a.className),"style"in a&&n(3,i=a.style)},[o,s,r,i]}class Ie extends ${constructor(e){super(),x(this,e,sa,oa,z,{icon:0,id:1,className:2,style:3})}}const ra=t=>({focus:t&1}),Cn=t=>({focus:t[0]});function Bn(t,e,n){const o=t.slice();return o[13]=e[n],o}function Ln(t){let e,n,o,s,r,i,a;return n=new Ie({props:{icon:"#iconSearch",className:"b3-form__icon-icon"}}),{c(){e=P("div"),R(n.$$.fragment),o=j(),s=P("input"),y(s,"placeholder",t[4]),y(s,"class","b3-text-field fn__block b3-form__icon-input"),y(e,"class","b3-form__icon")},m(l,u){A(l,e,u),I(n,e,null),L(e,o),L(e,s),se(s,t[1]),r=!0,i||(a=[F(s,"input",t[9]),F(s,"change",t[5])],i=!0)},p(l,u){(!r||u&16)&&y(s,"placeholder",l[4]),u&2&&s.value!==l[1]&&se(s,l[1])},i(l){r||(w(n.$$.fragment,l),r=!0)},o(l){S(n.$$.fragment,l),r=!1},d(l){l&&v(e),N(n),i=!1,Z(a)}}}function Dn(t,e){let n,o,s,r,i=e[13].text+"",a,l,u,c,f;o=new Ie({props:{icon:e[13].icon,className:"b3-list-item__graphic"}});function g(){return e[10](e[13])}function d(){return e[11](e[13])}return{key:t,first:null,c(){n=P("li"),R(o.$$.fragment),s=j(),r=P("span"),a=j(),y(r,"class","b3-list-item__text svelte-15drd7h"),y(n,"role","button"),y(n,"data-name",l=e[13].name),y(n,"class","b3-list-item"),k(n,"b3-list-item--focus",e[13].key===e[0]),this.first=n},m(h,b){A(h,n,b),I(o,n,null),L(n,s),L(n,r),r.innerHTML=i,L(n,a),u=!0,c||(f=[F(n,"click",g),F(n,"keyup",d)],c=!0)},p(h,b){e=h;const p={};b&4&&(p.icon=e[13].icon),o.$set(p),(!u||b&4)&&i!==(i=e[13].text+"")&&(r.innerHTML=i),(!u||b&4&&l!==(l=e[13].name))&&y(n,"data-name",l),(!u||b&5)&&k(n,"b3-list-item--focus",e[13].key===e[0])},i(h){u||(w(o.$$.fragment,h),u=!0)},o(h){S(o.$$.fragment,h),u=!1},d(h){h&&v(n),N(o),c=!1,Z(f)}}}function ia(t){let e;return{c(){e=ye("Container")},m(n,o){A(n,e,o)},d(n){n&&v(e)}}}function aa(t){let e,n,o,s=[],r=new Map,i,a,l,u=t[3]&&Ln(t),c=ue(t[2]);const f=b=>b[13].key;for(let b=0;b<c.length;b+=1){let p=Bn(t,c,b),C=f(p);r.set(C,s[b]=Dn(C,p))}const g=t[8].default,d=J(g,t,t[7],Cn),h=d||ia();return{c(){e=P("div"),n=P("ul"),u&&u.c(),o=j();for(let b=0;b<s.length;b+=1)s[b].c();i=j(),a=P("div"),h&&h.c(),y(n,"class","b3-tab-bar b3-list b3-list--background"),y(a,"class","config__tab-wrap"),y(e,"class","fn__flex-1 fn__flex config__panel")},m(b,p){A(b,e,p),L(e,n),u&&u.m(n,null),L(n,o);for(let C=0;C<s.length;C+=1)s[C]&&s[C].m(n,null);L(e,i),L(e,a),h&&h.m(a,null),l=!0},p(b,[p]){b[3]?u?(u.p(b,p),p&8&&w(u,1)):(u=Ln(b),u.c(),w(u,1),u.m(n,o)):u&&(re(),S(u,1,1,()=>{u=null}),ie()),p&69&&(c=ue(b[2]),re(),s=He(s,p,f,1,b,c,r,n,ct,Dn,null,Bn),ie()),d&&d.p&&(!l||p&129)&&X(d,g,b,b[7],l?Y(g,b[7],p,ra):Q(b[7]),Cn)},i(b){if(!l){w(u);for(let p=0;p<c.length;p+=1)w(s[p]);w(h,b),l=!0}},o(b){S(u);for(let p=0;p<s.length;p+=1)S(s[p]);S(h,b),l=!1},d(b){b&&v(e),u&&u.d();for(let p=0;p<s.length;p+=1)s[p].d();h&&h.d(b)}}}function la(t,e,n){let{$$slots:o={},$$scope:s}=e,{panels:r}=e,{focus:i}=e,{searchEnable:a=!1}=e,{searchPlaceholder:l=""}=e,{searchValue:u=""}=e;const c=lt();function f(){c("search-changed",{value:u})}function g(p){c("changed",{key:p}),n(0,i=p)}function d(){u=this.value,n(1,u)}const h=p=>g(p.key),b=p=>g(p.key);return t.$$set=p=>{"panels"in p&&n(2,r=p.panels),"focus"in p&&n(0,i=p.focus),"searchEnable"in p&&n(3,a=p.searchEnable),"searchPlaceholder"in p&&n(4,l=p.searchPlaceholder),"searchValue"in p&&n(1,u=p.searchValue),"$$scope"in p&&n(7,s=p.$$scope)},[i,u,r,a,l,f,g,s,o,d,h,b]}class ca extends ${constructor(e){super(),x(this,e,la,aa,z,{panels:2,focus:0,searchEnable:3,searchPlaceholder:4,searchValue:1})}}function ua(t){let e,n;const o=t[4].default,s=J(o,t,t[3],null);return{c(){e=P("div"),s&&s.c(),y(e,"data-name",t[2]),y(e,"class","config__tab-container"),k(e,"fn__none",!t[0]),k(e,"config__tab-container--top",t[1])},m(r,i){A(r,e,i),s&&s.m(e,null),n=!0},p(r,[i]){s&&s.p&&(!n||i&8)&&X(s,o,r,r[3],n?Y(o,r[3],i,null):Q(r[3]),null),(!n||i&4)&&y(e,"data-name",r[2]),(!n||i&1)&&k(e,"fn__none",!r[0]),(!n||i&2)&&k(e,"config__tab-container--top",r[1])},i(r){n||(w(s,r),n=!0)},o(r){S(s,r),n=!1},d(r){r&&v(e),s&&s.d(r)}}}function fa(t,e,n){let{$$slots:o={},$$scope:s}=e,{display:r=!0}=e,{top:i=!0}=e,{name:a=""}=e;return t.$$set=l=>{"display"in l&&n(0,r=l.display),"top"in l&&n(1,i=l.top),"name"in l&&n(2,a=l.name),"$$scope"in l&&n(3,s=l.$$scope)},[r,i,a,s,o]}class In extends ${constructor(e){super(),x(this,e,fa,ua,z,{display:0,top:1,name:2})}}const ha=t=>({}),Nn=t=>({}),da=t=>({}),Rn=t=>({});function Mn(t){let e,n;const o=t[7].icon,s=J(o,t,t[6],Rn);return{c(){e=P("span"),s&&s.c(),y(e,"class","item__icon")},m(r,i){A(r,e,i),s&&s.m(e,null),n=!0},p(r,i){s&&s.p&&(!n||i&64)&&X(s,o,r,r[6],n?Y(o,r[6],i,da):Q(r[6]),Rn)},i(r){n||(w(s,r),n=!0)},o(r){S(s,r),n=!1},d(r){r&&v(e),s&&s.d(r)}}}function pa(t){let e;return{c(){e=ye("text")},m(n,o){A(n,e,o)},d(n){n&&v(e)}}}function ma(t){let e,n,o,s,r,i,a,l,u,c,f=t[0]&&t[4].icon&&Mn(t);const g=t[7].text,d=J(g,t,t[6],Nn),h=d||pa();return{c(){e=P("div"),n=P("span"),o=j(),f&&f.c(),s=j(),r=P("span"),h&&h.c(),i=j(),a=P("span"),y(n,"class","fn__flex-1"),y(r,"class","item__text"),y(a,"class","fn__flex-1"),y(e,"role","button"),y(e,"data-type",t[1]),y(e,"class","item item--full"),k(e,"item--focus",t[2])},m(b,p){A(b,e,p),L(e,n),L(e,o),f&&f.m(e,null),L(e,s),L(e,r),h&&h.m(r,null),L(e,i),L(e,a),l=!0,u||(c=F(e,"click",t[3]),u=!0)},p(b,[p]){b[0]&&b[4].icon?f?(f.p(b,p),p&17&&w(f,1)):(f=Mn(b),f.c(),w(f,1),f.m(e,s)):f&&(re(),S(f,1,1,()=>{f=null}),ie()),d&&d.p&&(!l||p&64)&&X(d,g,b,b[6],l?Y(g,b[6],p,ha):Q(b[6]),Nn),(!l||p&2)&&y(e,"data-type",b[1]),(!l||p&4)&&k(e,"item--focus",b[2])},i(b){l||(w(f),w(h,b),l=!0)},o(b){S(f),S(h,b),l=!1},d(b){b&&v(e),f&&f.d(),h&&h.d(b),u=!1,c()}}}function ga(t,e,n){let{$$slots:o={},$$scope:s}=e;const r=qi(o);let{key:i}=e,{icon:a}=e,{name:l=""}=e,{focus:u=!1}=e;const c=lt();function f(){u||c("changed",{key:i})}return t.$$set=g=>{"key"in g&&n(5,i=g.key),"icon"in g&&n(0,a=g.icon),"name"in g&&n(1,l=g.name),"focus"in g&&n(2,u=g.focus),"$$scope"in g&&n(6,s=g.$$scope)},[a,l,u,f,r,i,s,o]}let ba=class extends ${constructor(e){super(),x(this,e,ga,ma,z,{key:5,icon:0,name:1,focus:2})}};const _a=t=>({focus:t&1}),jn=t=>({focus:t[0]});function Fn(t,e,n){const o=t.slice();return o[5]=e[n],o}function ya(t){let e,n=t[5].icon+"",o;return{c(){e=new at(!1),o=te(),e.a=o},m(s,r){e.m(n,s,r),A(s,o,r)},p(s,r){r&2&&n!==(n=s[5].icon+"")&&e.p(n)},i:K,o:K,d(s){s&&(v(o),e.d())}}}function wa(t){let e,n;return e=new Ie({props:{icon:t[5].icon}}),{c(){R(e.$$.fragment)},m(o,s){I(e,o,s),n=!0},p(o,s){const r={};s&2&&(r.icon=o[5].icon),e.$set(r)},i(o){n||(w(e.$$.fragment,o),n=!0)},o(o){S(e.$$.fragment,o),n=!1},d(o){N(e,o)}}}function ka(t){let e,n,o,s,r,i;const a=[wa,ya],l=[];function u(c,f){var g;return f&2&&(n=null),n==null&&(n=!!((g=c[5].icon)!=null&&g.startsWith("#"))),n?0:c[5].icon?1:-1}return~(o=u(t,-1))&&(s=l[o]=a[o](t)),{c(){e=P("span"),s&&s.c(),r=j(),y(e,"slot","icon")},m(c,f){A(c,e,f),~o&&l[o].m(e,null),L(e,r),i=!0},p(c,f){let g=o;o=u(c,f),o===g?~o&&l[o].p(c,f):(s&&(re(),S(l[g],1,1,()=>{l[g]=null}),ie()),~o?(s=l[o],s?s.p(c,f):(s=l[o]=a[o](c),s.c()),w(s,1),s.m(e,r)):s=null)},i(c){i||(w(s),i=!0)},o(c){S(s),i=!1},d(c){c&&v(e),~o&&l[o].d()}}}function Sa(t){let e,n,o=t[5].text+"",s;return{c(){e=P("span"),n=new at(!1),s=j(),n.a=s,y(e,"slot","text")},m(r,i){A(r,e,i),n.m(o,e),L(e,s)},p(r,i){i&2&&o!==(o=r[5].text+"")&&n.p(o)},d(r){r&&v(e)}}}function Un(t,e){let n,o,s;return o=new ba({props:{key:e[5].key,icon:!!e[5].icon,name:e[5].name,focus:e[5].key===e[0],$$slots:{text:[Sa],icon:[ka]},$$scope:{ctx:e}}}),o.$on("changed",e[2]),{key:t,first:null,c(){n=te(),R(o.$$.fragment),this.first=n},m(r,i){A(r,n,i),I(o,r,i),s=!0},p(r,i){e=r;const a={};i&2&&(a.key=e[5].key),i&2&&(a.icon=!!e[5].icon),i&2&&(a.name=e[5].name),i&3&&(a.focus=e[5].key===e[0]),i&18&&(a.$$scope={dirty:i,ctx:e}),o.$set(a)},i(r){s||(w(o.$$.fragment,r),s=!0)},o(r){S(o.$$.fragment,r),s=!1},d(r){r&&v(n),N(o,r)}}}function Ea(t){let e;return{c(){e=ye("Container")},m(n,o){A(n,e,o)},d(n){n&&v(e)}}}function Ta(t){let e,n,o=[],s=new Map,r,i,a,l=ue(t[1]);const u=d=>d[5].key;for(let d=0;d<l.length;d+=1){let h=Fn(t,l,d),b=u(h);s.set(b,o[d]=Un(b,h))}const c=t[3].default,f=J(c,t,t[4],jn),g=f||Ea();return{c(){e=P("div"),n=P("div");for(let d=0;d<o.length;d+=1)o[d].c();r=j(),i=P("div"),g&&g.c(),y(n,"class","layout-tab-bar fn__flex"),y(i,"class","fn__flex-1"),y(e,"class","fn__flex-column"),Re(e,"height","100%")},m(d,h){A(d,e,h),L(e,n);for(let b=0;b<o.length;b+=1)o[b]&&o[b].m(n,null);L(e,r),L(e,i),g&&g.m(i,null),a=!0},p(d,[h]){h&7&&(l=ue(d[1]),re(),o=He(o,h,u,1,d,l,s,n,ct,Un,null,Fn),ie()),f&&f.p&&(!a||h&17)&&X(f,c,d,d[4],a?Y(c,d[4],h,_a):Q(d[4]),jn)},i(d){if(!a){for(let h=0;h<l.length;h+=1)w(o[h]);w(g,d),a=!0}},o(d){for(let h=0;h<o.length;h+=1)S(o[h]);S(g,d),a=!1},d(d){d&&v(e);for(let h=0;h<o.length;h+=1)o[h].d();g&&g.d(d)}}}function va(t,e,n){let{$$slots:o={},$$scope:s}=e,{tabs:r}=e,{focus:i}=e;function a(l){n(0,i=l.detail.key)}return t.$$set=l=>{"tabs"in l&&n(1,r=l.tabs),"focus"in l&&n(0,i=l.focus),"$$scope"in l&&n(4,s=l.$$scope)},[i,r,a,o,s]}class Aa extends ${constructor(e){super(),x(this,e,va,Ta,z,{tabs:1,focus:0})}}const Oa=t=>({}),qn=t=>({}),Pa=t=>({}),Wn=t=>({}),Ca=t=>({}),Kn=t=>({}),Ba=t=>({}),Hn=t=>({});function La(t){let e,n;return{c(){e=new at(!1),n=te(),e.a=n},m(o,s){e.m(t[0],o,s),A(o,n,s)},p(o,s){s&1&&e.p(o[0])},d(o){o&&(v(n),e.d())}}}function Da(t){let e,n;return{c(){e=new at(!1),n=te(),e.a=n},m(o,s){e.m(t[1],o,s),A(o,n,s)},p(o,s){s&2&&e.p(o[1])},d(o){o&&(v(n),e.d())}}}function zn(t){let e,n,o;const s=t[4].input,r=J(s,t,t[3],Wn);return{c(){e=P("div"),n=j(),r&&r.c(),y(e,"class","fn__hr")},m(i,a){A(i,e,a),A(i,n,a),r&&r.m(i,a),o=!0},p(i,a){r&&r.p&&(!o||a&8)&&X(r,s,i,i[3],o?Y(s,i[3],a,Pa):Q(i[3]),Wn)},i(i){o||(w(r,i),o=!0)},o(i){S(r,i),o=!1},d(i){i&&(v(e),v(n)),r&&r.d(i)}}}function Gn(t){let e,n,o;const s=t[4].input,r=J(s,t,t[3],qn);return{c(){e=P("span"),n=j(),r&&r.c(),y(e,"class","fn__space")},m(i,a){A(i,e,a),A(i,n,a),r&&r.m(i,a),o=!0},p(i,a){r&&r.p&&(!o||a&8)&&X(r,s,i,i[3],o?Y(s,i[3],a,Oa):Q(i[3]),qn)},i(i){o||(w(r,i),o=!0)},o(i){S(r,i),o=!1},d(i){i&&(v(e),v(n)),r&&r.d(i)}}}function Ia(t){let e,n,o,s,r,i,a;const l=t[4].title,u=J(l,t,t[3],Hn),c=u||La(t),f=t[4].text,g=J(f,t,t[3],Kn),d=g||Da(t);let h=t[2]&&zn(t),b=!t[2]&&Gn(t);return{c(){e=P("label"),n=P("div"),c&&c.c(),o=j(),s=P("div"),d&&d.c(),r=j(),h&&h.c(),i=j(),b&&b.c(),y(s,"class","b3-label__text"),y(n,"class","fn__flex-1 svelte-2m76cy"),k(n,"visible",t[2]),y(e,"class","fn__flex b3-label")},m(p,C){A(p,e,C),L(e,n),c&&c.m(n,null),L(n,o),L(n,s),d&&d.m(s,null),L(n,r),h&&h.m(n,null),L(e,i),b&&b.m(e,null),a=!0},p(p,[C]){u?u.p&&(!a||C&8)&&X(u,l,p,p[3],a?Y(l,p[3],C,Ba):Q(p[3]),Hn):c&&c.p&&(!a||C&1)&&c.p(p,a?C:-1),g?g.p&&(!a||C&8)&&X(g,f,p,p[3],a?Y(f,p[3],C,Ca):Q(p[3]),Kn):d&&d.p&&(!a||C&2)&&d.p(p,a?C:-1),p[2]?h?(h.p(p,C),C&4&&w(h,1)):(h=zn(p),h.c(),w(h,1),h.m(n,null)):h&&(re(),S(h,1,1,()=>{h=null}),ie()),(!a||C&4)&&k(n,"visible",p[2]),p[2]?b&&(re(),S(b,1,1,()=>{b=null}),ie()):b?(b.p(p,C),C&4&&w(b,1)):(b=Gn(p),b.c(),w(b,1),b.m(e,null))},i(p){a||(w(c,p),w(d,p),w(h),w(b),a=!0)},o(p){S(c,p),S(d,p),S(h),S(b),a=!1},d(p){p&&v(e),c&&c.d(p),d&&d.d(p),h&&h.d(),b&&b.d()}}}function Na(t,e,n){let{$$slots:o={},$$scope:s}=e,{title:r=""}=e,{text:i=""}=e,{block:a=!1}=e;return t.$$set=l=>{"title"in l&&n(0,r=l.title),"text"in l&&n(1,i=l.text),"block"in l&&n(2,a=l.block),"$$scope"in l&&n(3,s=l.$$scope)},[r,i,a,s,o]}let we=class extends ${constructor(e){super(),x(this,e,Na,Ia,z,{title:0,text:1,block:2})}};var V=(t=>(t[t.checkbox=0]="checkbox",t[t.text=1]="text",t[t.number=2]="number",t[t.slider=3]="slider",t[t.button=4]="button",t[t.select=5]="select",t[t.textarea=6]="textarea",t))(V||{});function Vn(t,e,n){const o=t.slice();return o[20]=e[n],o}function Ra(t){let e,n,o;return{c(){e=P("textarea"),e.disabled=t[2],y(e,"class","b3-text-field"),y(e,"placeholder",t[5]),k(e,"fn__block",t[3]),k(e,"fn__size200",!t[3]&&t[4]),Re(e,"height",t[8]>0?`${t[8]}px`:void 0),Re(e,"font-family",t[9]?t[9]:void 0)},m(s,r){A(s,e,r),se(e,t[0]),n||(o=[F(e,"input",t[18]),F(e,"change",t[11])],n=!0)},p(s,r){r&4&&(e.disabled=s[2]),r&32&&y(e,"placeholder",s[5]),r&65&&se(e,s[0]),r&8&&k(e,"fn__block",s[3]),r&24&&k(e,"fn__size200",!s[3]&&s[4]),r&256&&Re(e,"height",s[8]>0?`${s[8]}px`:void 0),r&512&&Re(e,"font-family",s[9]?s[9]:void 0)},d(s){s&&v(e),n=!1,Z(o)}}}function Ma(t){let e,n=[],o=new Map,s,r,i=ue(t[6]);const a=l=>l[20].key;for(let l=0;l<i.length;l+=1){let u=Vn(t,i,l),c=a(u);o.set(c,n[l]=Jn(c,u))}return{c(){e=P("select");for(let l=0;l<n.length;l+=1)n[l].c();e.disabled=t[2],y(e,"class","b3-select"),t[0]===void 0&&et(()=>t[17].call(e)),k(e,"fn__block",t[3]),k(e,"fn__size200",!t[3]&&t[4]),k(e,"fn__flex-center",!t[3])},m(l,u){A(l,e,u);for(let c=0;c<n.length;c+=1)n[c]&&n[c].m(e,null);vn(e,t[0],!0),s||(r=[F(e,"change",t[17]),F(e,"change",t[11])],s=!0)},p(l,u){u&64&&(i=ue(l[6]),n=He(n,u,a,1,l,i,o,e,ea,Jn,null,Vn)),u&4&&(e.disabled=l[2]),u&65&&vn(e,l[0]),u&8&&k(e,"fn__block",l[3]),u&24&&k(e,"fn__size200",!l[3]&&l[4]),u&8&&k(e,"fn__flex-center",!l[3])},d(l){l&&v(e);for(let u=0;u<n.length;u+=1)n[u].d();s=!1,Z(r)}}}function ja(t){let e,n,o,s;return{c(){e=P("button"),n=ye(t[0]),e.disabled=t[2],y(e,"class","b3-button b3-button--outline"),k(e,"fn__block",t[3]),k(e,"fn__size200",!t[3]&&t[4]),k(e,"fn__flex-center",!t[3])},m(r,i){A(r,e,i),L(e,n),o||(s=F(e,"click",t[10]),o=!0)},p(r,i){i&1&&Vt(n,r[0]),i&4&&(e.disabled=r[2]),i&8&&k(e,"fn__block",r[3]),i&24&&k(e,"fn__size200",!r[3]&&r[4]),i&8&&k(e,"fn__flex-center",!r[3])},d(r){r&&v(e),o=!1,s()}}}function Fa(t){let e,n,o,s,r,i;return{c(){e=P("input"),e.disabled=t[2],y(e,"class","b3-slider svelte-edt8og"),y(e,"type","range"),y(e,"min",n=t[7].min),y(e,"max",o=t[7].max),y(e,"step",s=t[7].step),k(e,"fn__block",t[3]),k(e,"fn__size200",!t[3]&&t[4])},m(a,l){A(a,e,l),se(e,t[0]),r||(i=[F(e,"change",t[16]),F(e,"input",t[16]),F(e,"change",t[11])],r=!0)},p(a,l){l&4&&(e.disabled=a[2]),l&128&&n!==(n=a[7].min)&&y(e,"min",n),l&128&&o!==(o=a[7].max)&&y(e,"max",o),l&128&&s!==(s=a[7].step)&&y(e,"step",s),l&65&&se(e,a[0]),l&8&&k(e,"fn__block",a[3]),l&24&&k(e,"fn__size200",!a[3]&&a[4])},d(a){a&&v(e),r=!1,Z(i)}}}function Ua(t){let e,n,o,s,r,i;return{c(){e=P("input"),e.disabled=t[2],y(e,"class","b3-text-field"),y(e,"type","number"),y(e,"placeholder",t[5]),y(e,"min",n=t[7].min),y(e,"max",o=t[7].max),y(e,"step",s=t[7].step),k(e,"fn__block",t[3]),k(e,"fn__size200",!t[3]&&t[4]),k(e,"fn__flex-center",!t[3])},m(a,l){A(a,e,l),se(e,t[0]),r||(i=[F(e,"input",t[15]),F(e,"change",t[11])],r=!0)},p(a,l){l&4&&(e.disabled=a[2]),l&32&&y(e,"placeholder",a[5]),l&128&&n!==(n=a[7].min)&&y(e,"min",n),l&128&&o!==(o=a[7].max)&&y(e,"max",o),l&128&&s!==(s=a[7].step)&&y(e,"step",s),l&65&&Nt(e.value)!==a[0]&&se(e,a[0]),l&8&&k(e,"fn__block",a[3]),l&24&&k(e,"fn__size200",!a[3]&&a[4]),l&8&&k(e,"fn__flex-center",!a[3])},d(a){a&&v(e),r=!1,Z(i)}}}function qa(t){let e,n,o;return{c(){e=P("input"),e.disabled=t[2],y(e,"class","b3-text-field"),y(e,"placeholder",t[5]),k(e,"fn__block",t[3]),k(e,"fn__size200",!t[3]&&t[4]),k(e,"fn__flex-center",!t[3])},m(s,r){A(s,e,r),se(e,t[0]),n||(o=[F(e,"input",t[14]),F(e,"change",t[11])],n=!0)},p(s,r){r&4&&(e.disabled=s[2]),r&32&&y(e,"placeholder",s[5]),r&65&&e.value!==s[0]&&se(e,s[0]),r&8&&k(e,"fn__block",s[3]),r&24&&k(e,"fn__size200",!s[3]&&s[4]),r&8&&k(e,"fn__flex-center",!s[3])},d(s){s&&v(e),n=!1,Z(o)}}}function Wa(t){let e,n,o;return{c(){e=P("input"),e.disabled=t[2],y(e,"class","b3-switch svelte-edt8og"),y(e,"type","checkbox"),k(e,"fn__block",t[3]),k(e,"fn__flex-center",!t[3])},m(s,r){A(s,e,r),e.checked=t[0],n||(o=[F(e,"change",t[13]),F(e,"change",t[11])],n=!0)},p(s,r){r&4&&(e.disabled=s[2]),r&65&&(e.checked=s[0]),r&8&&k(e,"fn__block",s[3]),r&8&&k(e,"fn__flex-center",!s[3])},d(s){s&&v(e),n=!1,Z(o)}}}function Jn(t,e){let n,o=e[20].text+"",s,r;return{key:t,first:null,c(){n=P("option"),s=ye(o),n.__value=r=e[20].key,se(n,n.__value),this.first=n},m(i,a){A(i,n,a),L(n,s)},p(i,a){e=i,a&64&&o!==(o=e[20].text+"")&&Vt(s,o),a&64&&r!==(r=e[20].key)&&(n.__value=r,se(n,n.__value))},d(i){i&&v(n)}}}function Ka(t){let e;function n(r,i){if(r[1]===V.checkbox)return Wa;if(r[1]===V.text)return qa;if(r[1]===V.number)return Ua;if(r[1]===V.slider)return Fa;if(r[1]===V.button)return ja;if(r[1]===V.select)return Ma;if(r[1]===V.textarea)return Ra}let o=n(t),s=o&&o(t);return{c(){s&&s.c(),e=te()},m(r,i){s&&s.m(r,i),A(r,e,i)},p(r,[i]){o===(o=n(r))&&s?s.p(r,i):(s&&s.d(1),s=o&&o(r),s&&(s.c(),s.m(e.parentNode,e)))},i:K,o:K,d(r){r&&v(e),s&&s.d(r)}}}function Ha(t,e,n){let{type:o}=e,{settingKey:s}=e,{settingValue:r}=e,{disabled:i=!1}=e,{block:a=!1}=e,{normal:l=!0}=e,{placeholder:u=""}=e,{options:c=[]}=e,{limits:f={min:0,max:100,step:1}}=e,{height:g=0}=e,{fontFamily:d=""}=e;const h=lt();function b(E){h("clicked",{event:E})}function p(E){h("changed",{key:s,value:r,event:E})}function C(){r=this.checked,n(0,r),n(6,c)}function G(){r=this.value,n(0,r),n(6,c)}function ne(){r=Nt(this.value),n(0,r),n(6,c)}function T(){r=Nt(this.value),n(0,r),n(6,c)}function M(){r=Ji(this),n(0,r),n(6,c)}function q(){r=this.value,n(0,r),n(6,c)}return t.$$set=E=>{"type"in E&&n(1,o=E.type),"settingKey"in E&&n(12,s=E.settingKey),"settingValue"in E&&n(0,r=E.settingValue),"disabled"in E&&n(2,i=E.disabled),"block"in E&&n(3,a=E.block),"normal"in E&&n(4,l=E.normal),"placeholder"in E&&n(5,u=E.placeholder),"options"in E&&n(6,c=E.options),"limits"in E&&n(7,f=E.limits),"height"in E&&n(8,g=E.height),"fontFamily"in E&&n(9,d=E.fontFamily)},[r,o,i,a,l,u,c,f,g,d,b,p,s,C,G,ne,T,M,q]}class Se extends ${constructor(e){super(),x(this,e,Ha,Ka,z,{type:1,settingKey:12,settingValue:0,disabled:2,block:3,normal:4,placeholder:5,options:6,limits:7,height:8,fontFamily:9})}}function za(t){let e,n;return e=new Se({props:{slot:"input",type:V.button,settingKey:"reset",settingValue:t[1].settings.generalSettings.reset.text}}),e.$on("clicked",t[3]),{c(){R(e.$$.fragment)},m(o,s){I(e,o,s),n=!0},p:K,i(o){n||(w(e.$$.fragment,o),n=!0)},o(o){S(e.$$.fragment,o),n=!1},d(o){N(e,o)}}}function Ga(t){let e,n;return e=new Se({props:{slot:"input",type:V.button,settingKey:"deleteKeeWebConfig",settingValue:t[1].settings.generalSettings.deleteKeeWebConfig.text}}),e.$on("clicked",t[4]),{c(){R(e.$$.fragment)},m(o,s){I(e,o,s),n=!0},p:K,i(o){n||(w(e.$$.fragment,o),n=!0)},o(o){S(e.$$.fragment,o),n=!1},d(o){N(e,o)}}}function Va(t){let e,n,o,s;return e=new we({props:{title:t[1].settings.generalSettings.reset.title,text:t[1].settings.generalSettings.reset.description,$$slots:{input:[za]},$$scope:{ctx:t}}}),o=new we({props:{title:t[1].settings.generalSettings.deleteKeeWebConfig.title,text:t[1].settings.generalSettings.deleteKeeWebConfig.description,$$slots:{input:[Ga]},$$scope:{ctx:t}}}),{c(){R(e.$$.fragment),n=j(),R(o.$$.fragment)},m(r,i){I(e,r,i),A(r,n,i),I(o,r,i),s=!0},p(r,i){const a={};i&131072&&(a.$$scope={dirty:i,ctx:r}),e.$set(a);const l={};i&131072&&(l.$$scope={dirty:i,ctx:r}),o.$set(l)},i(r){s||(w(e.$$.fragment,r),w(o.$$.fragment,r),s=!0)},o(r){S(e.$$.fragment,r),S(o.$$.fragment,r),s=!1},d(r){r&&v(n),N(e,r),N(o,r)}}}function Ja(t){let e,n;return e=new Se({props:{slot:"input",type:V.checkbox,settingKey:"siyuan",settingValue:t[0].keeweb.plugin.siyuan.enable}}),e.$on("changed",t[8]),{c(){R(e.$$.fragment)},m(o,s){I(e,o,s),n=!0},p(o,s){const r={};s&1&&(r.settingValue=o[0].keeweb.plugin.siyuan.enable),e.$set(r)},i(o){n||(w(e.$$.fragment,o),n=!0)},o(o){S(e.$$.fragment,o),n=!1},d(o){N(e,o)}}}function Ya(t){let e,n;return e=new Se({props:{slot:"input",type:V.number,settingKey:"width",settingValue:t[0].window.width,limits:{min:320,max:15360,step:40}}}),e.$on("changed",t[9]),{c(){R(e.$$.fragment)},m(o,s){I(e,o,s),n=!0},p(o,s){const r={};s&1&&(r.settingValue=o[0].window.width),e.$set(r)},i(o){n||(w(e.$$.fragment,o),n=!0)},o(o){S(e.$$.fragment,o),n=!1},d(o){N(e,o)}}}function Xa(t){let e,n;return e=new Se({props:{slot:"input",type:V.number,settingKey:"height",settingValue:t[0].window.height,limits:{min:240,max:8640,step:40}}}),e.$on("changed",t[10]),{c(){R(e.$$.fragment)},m(o,s){I(e,o,s),n=!0},p(o,s){const r={};s&1&&(r.settingValue=o[0].window.height),e.$set(r)},i(o){n||(w(e.$$.fragment,o),n=!0)},o(o){S(e.$$.fragment,o),n=!1},d(o){N(e,o)}}}function Qa(t){let e,n;return e=new Se({props:{slot:"input",type:V.checkbox,settingKey:"center",settingValue:t[0].window.center}}),e.$on("changed",t[11]),{c(){R(e.$$.fragment)},m(o,s){I(e,o,s),n=!0},p(o,s){const r={};s&1&&(r.settingValue=o[0].window.center),e.$set(r)},i(o){n||(w(e.$$.fragment,o),n=!0)},o(o){S(e.$$.fragment,o),n=!1},d(o){N(e,o)}}}function Za(t){let e,n;return e=new Se({props:{slot:"input",type:V.checkbox,settingKey:"alwaysOnTop",settingValue:t[0].window.alwaysOnTop}}),e.$on("changed",t[12]),{c(){R(e.$$.fragment)},m(o,s){I(e,o,s),n=!0},p(o,s){const r={};s&1&&(r.settingValue=o[0].window.alwaysOnTop),e.$set(r)},i(o){n||(w(e.$$.fragment,o),n=!0)},o(o){S(e.$$.fragment,o),n=!1},d(o){N(e,o)}}}function xa(t){let e,n,o,s,r,i,a,l,u,c,f,g;return n=new we({props:{title:t[1].settings.keewebSettings.pluginTab.siyuan.title,text:t[1].settings.keewebSettings.pluginTab.siyuan.description,$$slots:{input:[Ja]},$$scope:{ctx:t}}}),r=new we({props:{title:t[1].settings.keewebSettings.windowTab.width.title,text:t[1].settings.keewebSettings.windowTab.width.description,$$slots:{input:[Ya]},$$scope:{ctx:t}}}),a=new we({props:{title:t[1].settings.keewebSettings.windowTab.height.title,text:t[1].settings.keewebSettings.windowTab.height.description,$$slots:{input:[Xa]},$$scope:{ctx:t}}}),u=new we({props:{title:t[1].settings.keewebSettings.windowTab.center.title,text:t[1].settings.keewebSettings.windowTab.center.description,$$slots:{input:[Qa]},$$scope:{ctx:t}}}),f=new we({props:{title:t[1].settings.keewebSettings.windowTab.top.title,text:t[1].settings.keewebSettings.windowTab.top.description,$$slots:{input:[Za]},$$scope:{ctx:t}}}),{c(){e=P("div"),R(n.$$.fragment),o=j(),s=P("div"),R(r.$$.fragment),i=j(),R(a.$$.fragment),l=j(),R(u.$$.fragment),c=j(),R(f.$$.fragment),y(e,"data-type",t[6].keeweb[0].name),k(e,"fn__none",t[6].keeweb[0].key!==t[16]),y(s,"data-type",t[6].keeweb[1].name),k(s,"fn__none",t[6].keeweb[1].key!==t[16])},m(d,h){A(d,e,h),I(n,e,null),A(d,o,h),A(d,s,h),I(r,s,null),L(s,i),I(a,s,null),L(s,l),I(u,s,null),L(s,c),I(f,s,null),g=!0},p(d,h){const b={};h&131073&&(b.$$scope={dirty:h,ctx:d}),n.$set(b),(!g||h&65600)&&k(e,"fn__none",d[6].keeweb[0].key!==d[16]);const p={};h&131073&&(p.$$scope={dirty:h,ctx:d}),r.$set(p);const C={};h&131073&&(C.$$scope={dirty:h,ctx:d}),a.$set(C);const G={};h&131073&&(G.$$scope={dirty:h,ctx:d}),u.$set(G);const ne={};h&131073&&(ne.$$scope={dirty:h,ctx:d}),f.$set(ne),(!g||h&65600)&&k(s,"fn__none",d[6].keeweb[1].key!==d[16])},i(d){g||(w(n.$$.fragment,d),w(r.$$.fragment,d),w(a.$$.fragment,d),w(u.$$.fragment,d),w(f.$$.fragment,d),g=!0)},o(d){S(n.$$.fragment,d),S(r.$$.fragment,d),S(a.$$.fragment,d),S(u.$$.fragment,d),S(f.$$.fragment,d),g=!1},d(d){d&&(v(e),v(o),v(s)),N(n),N(r),N(a),N(u),N(f)}}}function $a(t){let e,n;return e=new Aa({props:{focus:ol,tabs:t[6].keeweb,$$slots:{default:[xa,({focus:o})=>({16:o}),({focus:o})=>o?65536:0]},$$scope:{ctx:t}}}),{c(){R(e.$$.fragment)},m(o,s){I(e,o,s),n=!0},p(o,s){const r={};s&196609&&(r.$$scope={dirty:s,ctx:o}),e.$set(r)},i(o){n||(w(e.$$.fragment,o),n=!0)},o(o){S(e.$$.fragment,o),n=!1},d(o){N(e,o)}}}function el(t){let e,n,o,s;return e=new In({props:{display:t[5][0].key===t[15],$$slots:{default:[Va]},$$scope:{ctx:t}}}),o=new In({props:{display:t[5][1].key===t[15],$$slots:{default:[$a]},$$scope:{ctx:t}}}),{c(){R(e.$$.fragment),n=j(),R(o.$$.fragment)},m(r,i){I(e,r,i),A(r,n,i),I(o,r,i),s=!0},p(r,i){const a={};i&32768&&(a.display=r[5][0].key===r[15]),i&131072&&(a.$$scope={dirty:i,ctx:r}),e.$set(a);const l={};i&32768&&(l.display=r[5][1].key===r[15]),i&131073&&(l.$$scope={dirty:i,ctx:r}),o.$set(l)},i(r){s||(w(e.$$.fragment,r),w(o.$$.fragment,r),s=!0)},o(r){S(e.$$.fragment,r),S(o.$$.fragment,r),s=!1},d(r){r&&v(n),N(e,r),N(o,r)}}}function tl(t){let e,n;return e=new ca({props:{panels:t[5],focus:nl,$$slots:{default:[el,({focus:o})=>({15:o}),({focus:o})=>o?32768:0]},$$scope:{ctx:t}}}),{c(){R(e.$$.fragment)},m(o,s){I(e,o,s),n=!0},p(o,[s]){const r={};s&163841&&(r.$$scope={dirty:s,ctx:o}),e.$set(r)},i(o){n||(w(e.$$.fragment,o),n=!0)},o(o){S(e.$$.fragment,o),n=!1},d(o){N(e,o)}}}let nl=0,ol=0;function sl(t,e,n){let{config:o}=e,{plugin:s}=e;const r=s.i18n;async function i(){await s.updateConfig(o)}function a(){s.siyuan.confirm(r.settings.generalSettings.reset.title,r.settings.generalSettings.reset.description,async()=>{await s.resetConfig(),globalThis.location.reload()})}function l(){s.siyuan.confirm(r.settings.generalSettings.deleteKeeWebConfig.title,r.settings.generalSettings.deleteKeeWebConfig.description,async()=>{await s.deleteKeeWebUserConfig()})}const u=[{key:0,text:r.settings.generalSettings.title,name:r.settings.generalSettings.title,icon:"#iconSettings"},{key:1,text:r.settings.keewebSettings.title,name:r.settings.keewebSettings.title,icon:"#icon-keepass-keeweb"}],c={keeweb:[{key:0,text:r.settings.keewebSettings.pluginTab.title,name:r.settings.keewebSettings.pluginTab.title,icon:"🧩"},{key:1,text:r.settings.keewebSettings.windowTab.title,name:r.settings.keewebSettings.windowTab.title,icon:"🗔"}]},f=async p=>{n(0,o.keeweb.plugin.siyuan.enable=p.detail.value,o),await i()},g=async p=>{n(0,o.window.width=p.detail.value,o),await i()},d=async p=>{n(0,o.window.height=p.detail.value,o),await i()},h=async p=>{n(0,o.window.center=p.detail.value,o),await i()},b=async p=>{n(0,o.window.alwaysOnTop=p.detail.value,o),await i()};return t.$$set=p=>{"config"in p&&n(0,o=p.config),"plugin"in p&&n(7,s=p.plugin)},[o,r,i,a,l,u,c,s,f,g,d,h,b]}class rl extends ${constructor(e){super(),x(this,e,sl,tl,z,{config:0,plugin:7})}}const ve=[];function me(t,e=K){let n;const o=new Set;function s(a){if(z(t,a)&&(t=a,n)){const l=!ve.length;for(const u of o)u[1](),ve.push(u,t);if(l){for(let u=0;u<ve.length;u+=2)ve[u][0](ve[u+1]);ve.length=0}}}function r(a){s(a(t))}function i(a,l=K){const u=[a,l];return o.add(u),o.size===1&&(n=e(s,r)||K),a(t),()=>{o.delete(u),o.size===0&&n&&(n(),n=null)}}return{set:s,update:r,subscribe:i}}const il=t=>({}),Yn=t=>({});function Xn(t){let e,n;return e=new Ie({props:{id:t[1],icon:t[2]}}),{c(){R(e.$$.fragment)},m(o,s){I(e,o,s),n=!0},p(o,s){const r={};s&2&&(r.id=o[1]),s&4&&(r.icon=o[2]),e.$set(r)},i(o){n||(w(e.$$.fragment,o),n=!0)},o(o){S(e.$$.fragment,o),n=!1},d(o){N(e,o)}}}function al(t){let e,n,o=t[2]&&Xn(t);return{c(){o&&o.c(),e=te()},m(s,r){o&&o.m(s,r),A(s,e,r),n=!0},p(s,r){s[2]?o?(o.p(s,r),r&4&&w(o,1)):(o=Xn(s),o.c(),w(o,1),o.m(e.parentNode,e)):o&&(re(),S(o,1,1,()=>{o=null}),ie())},i(s){n||(w(o),n=!0)},o(s){S(o),n=!1},d(s){s&&v(e),o&&o.d(s)}}}function ll(t){let e,n,o,s,r;const i=t[8].svg,a=J(i,t,t[7],Yn),l=a||al(t);return{c(){e=P("span"),l&&l.c(),n=j(),o=P("span"),s=ye(t[3]),y(o,"title",t[4]),y(o,"class","protyle-breadcrumb__text"),k(o,"protyle-breadcrumb__text--ellipsis",t[5]),y(e,"data-node-id",t[0]),y(e,"class","protyle-breadcrumb__item"),k(e,"protyle-breadcrumb__item--active",t[6])},m(u,c){A(u,e,c),l&&l.m(e,null),L(e,n),L(e,o),L(o,s),r=!0},p(u,[c]){a?a.p&&(!r||c&128)&&X(a,i,u,u[7],r?Y(i,u[7],c,il):Q(u[7]),Yn):l&&l.p&&(!r||c&6)&&l.p(u,r?c:-1),(!r||c&8)&&Vt(s,u[3]),(!r||c&16)&&y(o,"title",u[4]),(!r||c&32)&&k(o,"protyle-breadcrumb__text--ellipsis",u[5]),(!r||c&1)&&y(e,"data-node-id",u[0]),(!r||c&64)&&k(e,"protyle-breadcrumb__item--active",u[6])},i(u){r||(w(l,u),r=!0)},o(u){S(l,u),r=!1},d(u){u&&v(e),l&&l.d(u)}}}function cl(t,e,n){let{$$slots:o={},$$scope:s}=e,{itemId:r=""}=e,{iconId:i=""}=e,{icon:a=""}=e,{text:l=""}=e,{textTitle:u=""}=e,{textEllipsis:c=!0}=e,{active:f=!1}=e;return t.$$set=g=>{"itemId"in g&&n(0,r=g.itemId),"iconId"in g&&n(1,i=g.iconId),"icon"in g&&n(2,a=g.icon),"text"in g&&n(3,l=g.text),"textTitle"in g&&n(4,u=g.textTitle),"textEllipsis"in g&&n(5,c=g.textEllipsis),"active"in g&&n(6,f=g.active),"$$scope"in g&&n(7,s=g.$$scope)},[r,i,a,l,u,c,f,s,o]}class ul extends ${constructor(e){super(),x(this,e,cl,ll,z,{itemId:0,iconId:1,icon:2,text:3,textTitle:4,textEllipsis:5,active:6})}}function Qn(t,e,n){const o=t.slice();return o[3]=e[n],o[5]=n,o}function fl(t){let e,n;return e=new Ie({props:{className:"protyle-breadcrumb__arrow",icon:t[3].icon||"#iconRight"}}),{c(){R(e.$$.fragment)},m(o,s){I(e,o,s),n=!0},p(o,s){const r={};s&1&&(r.icon=o[3].icon||"#iconRight"),e.$set(r)},i(o){n||(w(e.$$.fragment,o),n=!0)},o(o){S(e.$$.fragment,o),n=!1},d(o){N(e,o)}}}function hl(t){let e,n;const o=[t[3]];let s={};for(let r=0;r<o.length;r+=1)s=it(s,o[r]);return e=new ul({props:s}),{c(){R(e.$$.fragment)},m(r,i){I(e,r,i),n=!0},p(r,i){const a=i&1?Jt(o,[zo(r[3])]):{};e.$set(a)},i(r){n||(w(e.$$.fragment,r),n=!0)},o(r){S(e.$$.fragment,r),n=!1},d(r){N(e,r)}}}function Zn(t,e){let n,o,s,r,i;const a=[hl,fl],l=[];function u(c,f){return c[3].type==="item"?0:c[3].type==="arrow"?1:-1}return~(o=u(e))&&(s=l[o]=a[o](e)),{key:t,first:null,c(){n=te(),s&&s.c(),r=te(),this.first=n},m(c,f){A(c,n,f),~o&&l[o].m(c,f),A(c,r,f),i=!0},p(c,f){e=c;let g=o;o=u(e),o===g?~o&&l[o].p(e,f):(s&&(re(),S(l[g],1,1,()=>{l[g]=null}),ie()),~o?(s=l[o],s?s.p(e,f):(s=l[o]=a[o](e),s.c()),w(s,1),s.m(r.parentNode,r)):s=null)},i(c){i||(w(s),i=!0)},o(c){S(s),i=!1},d(c){c&&(v(n),v(r)),~o&&l[o].d(c)}}}function dl(t){let e=[],n=new Map,o,s,r=ue(t[0]);const i=a=>a[5];for(let a=0;a<r.length;a+=1){let l=Qn(t,r,a),u=i(l);n.set(u,e[a]=Zn(u,l))}return{c(){for(let a=0;a<e.length;a+=1)e[a].c();o=te()},m(a,l){for(let u=0;u<e.length;u+=1)e[u]&&e[u].m(a,l);A(a,o,l),s=!0},p(a,l){l&1&&(r=ue(a[0]),re(),e=He(e,l,i,1,a,r,n,o.parentNode,ct,Zn,o,Qn),ie())},i(a){if(!s){for(let l=0;l<r.length;l+=1)w(e[l]);s=!0}},o(a){for(let l=0;l<e.length;l+=1)S(e[l]);s=!1},d(a){a&&v(o);for(let l=0;l<e.length;l+=1)e[l].d(a)}}}function pl(t){let e,n;const o=t[2].default,s=J(o,t,t[1],null),r=s||dl(t);return{c(){e=P("div"),r&&r.c(),y(e,"class","protyle-breadcrumb__bar protyle-breadcrumb__bar--nowrap")},m(i,a){A(i,e,a),r&&r.m(e,null),n=!0},p(i,[a]){s?s.p&&(!n||a&2)&&X(s,o,i,i[1],n?Y(o,i[1],a,null):Q(i[1]),null):r&&r.p&&(!n||a&1)&&r.p(i,n?a:-1)},i(i){n||(w(r,i),n=!0)},o(i){S(r,i),n=!1},d(i){i&&v(e),r&&r.d(i)}}}function ml(t,e,n){let{$$slots:o={},$$scope:s}=e,{items:r=[]}=e;return t.$$set=i=>{"items"in i&&n(0,r=i.items),"$$scope"in i&&n(1,s=i.$$scope)},[r,s,o]}class gl extends ${constructor(e){super(),x(this,e,ml,pl,z,{items:0})}}var be=(t=>(t.none="",t.n="b3-tooltips__n",t.ne="b3-tooltips__ne",t.e="b3-tooltips__e",t.se="b3-tooltips__se",t.s="b3-tooltips__s",t.sw="b3-tooltips__sw",t.w="b3-tooltips__w",t.nw="b3-tooltips__nw",t))(be||{});function wt(t){let e,n,o,s,r,i;n=new Ie({props:{icon:t[0]}});let a=[{role:"button"},{"data-type":t[5]},{"aria-label":t[6]},{class:o="block__icon fn__flex-center "+t[7]}],l={};for(let u=0;u<a.length;u+=1)l=it(l,a[u]);return{c(){e=P(t[8]),R(n.$$.fragment),En(t[8])(e,l),k(e,"fn__none",t[2]),k(e,"block__icon--show",t[1]),k(e,"toolbar__item--active",t[3]),k(e,"toolbar__item--disabled",t[4]),k(e,"b3-tooltips",t[7]!==be.none)},m(u,c){A(u,e,c),I(n,e,null),t[14](e),s=!0,r||(i=[F(e,"click",t[12]),F(e,"dblclick",t[13]),F(e,"click",t[15])],r=!0)},p(u,c){const f={};c&1&&(f.icon=u[0]),n.$set(f),En(u[8])(e,l=Jt(a,[{role:"button"},(!s||c&32)&&{"data-type":u[5]},(!s||c&64)&&{"aria-label":u[6]},(!s||c&128&&o!==(o="block__icon fn__flex-center "+u[7]))&&{class:o}])),k(e,"fn__none",u[2]),k(e,"block__icon--show",u[1]),k(e,"toolbar__item--active",u[3]),k(e,"toolbar__item--disabled",u[4]),k(e,"b3-tooltips",u[7]!==be.none)},i(u){s||(w(n.$$.fragment,u),s=!0)},o(u){S(n.$$.fragment,u),s=!1},d(u){u&&v(e),N(n),t[14](null),r=!1,Z(i)}}}function bl(t){let e=t[8],n,o=t[8]&&wt(t);return{c(){o&&o.c(),n=te()},m(s,r){o&&o.m(s,r),A(s,n,r)},p(s,[r]){s[8]?e?z(e,s[8])?(o.d(1),o=wt(s),e=s[8],o.c(),o.m(n.parentNode,n)):o.p(s,r):(o=wt(s),e=s[8],o.c(),o.m(n.parentNode,n)):e&&(o.d(1),o=null,e=s[8])},i:K,o(s){S(o,s)},d(s){s&&v(n),o&&o.d(s)}}}function _l(t,e,n){let{icon:o="#iconHelp"}=e,{tag:s="button"}=e,{show:r=!0}=e,{none:i=!1}=e,{active:a=!1}=e,{disabled:l=!1}=e,{type:u=""}=e,{ariaLabel:c=""}=e,{tooltipsDirection:f=be.none}=e,{onClick:g=()=>null}=e,d;const h={icon:me(o),show:me(r),none:me(i),active:me(a),disabled:me(l),type:me(u),ariaLabel:me(c),tooltipsDirection:me(f)},b=[h.icon.subscribe(T=>n(0,o=T)),h.show.subscribe(T=>n(1,r=T)),h.none.subscribe(T=>n(2,i=T)),h.active.subscribe(T=>n(3,a=T)),h.disabled.subscribe(T=>n(4,l=T)),h.type.subscribe(T=>n(5,u=T)),h.ariaLabel.subscribe(T=>n(6,c=T)),h.tooltipsDirection.subscribe(T=>n(7,f=T))];Xi(()=>{b.forEach(T=>T())});function p(T){An.call(this,t,T)}function C(T){An.call(this,t,T)}function G(T){$e[T?"unshift":"push"](()=>{d=T,n(10,d)})}const ne=T=>g(T,d,h);return t.$$set=T=>{"icon"in T&&n(0,o=T.icon),"tag"in T&&n(8,s=T.tag),"show"in T&&n(1,r=T.show),"none"in T&&n(2,i=T.none),"active"in T&&n(3,a=T.active),"disabled"in T&&n(4,l=T.disabled),"type"in T&&n(5,u=T.type),"ariaLabel"in T&&n(6,c=T.ariaLabel),"tooltipsDirection"in T&&n(7,f=T.tooltipsDirection),"onClick"in T&&n(9,g=T.onClick)},t.$$.update=()=>{t.$$.dirty&1&&h.icon.set(o),t.$$.dirty&2&&h.show.set(r),t.$$.dirty&4&&h.none.set(i),t.$$.dirty&8&&h.active.set(a),t.$$.dirty&16&&h.disabled.set(l),t.$$.dirty&32&&h.type.set(u),t.$$.dirty&64&&h.ariaLabel.set(c),t.$$.dirty&128&&h.tooltipsDirection.set(f)},[o,r,i,a,l,u,c,f,s,g,d,h,p,C,G,ne]}class yl extends ${constructor(e){super(),x(this,e,_l,bl,z,{icon:0,tag:8,show:1,none:2,active:3,disabled:4,type:5,ariaLabel:6,tooltipsDirection:7,onClick:9})}}function xn(t,e,n){const o=t.slice();return o[4]=e[n],o[6]=n,o}const wl=t=>({}),$n=t=>({}),kl=t=>({}),eo=t=>({});function Sl(t){let e,n;return e=new gl({props:{items:t[0]}}),{c(){R(e.$$.fragment)},m(o,s){I(e,o,s),n=!0},p(o,s){const r={};s&1&&(r.items=o[0]),e.$set(r)},i(o){n||(w(e.$$.fragment,o),n=!0)},o(o){S(e.$$.fragment,o),n=!1},d(o){N(e,o)}}}function El(t){let e;return{c(){e=P("span"),y(e,"class","fn__space")},m(n,o){A(n,e,o)},d(n){n&&v(e)}}}function Tl(t){let e;return{c(){e=P("span"),y(e,"class","protyle-breadcrumb__space")},m(n,o){A(n,e,o)},d(n){n&&v(e)}}}function to(t,e){let n,o,s,r;function i(f,g){return f[6]===0?Tl:El}let a=i(e),l=a(e);const u=[e[4]];let c={};for(let f=0;f<u.length;f+=1)c=it(c,u[f]);return s=new yl({props:c}),{key:t,first:null,c(){n=te(),l.c(),o=j(),R(s.$$.fragment),this.first=n},m(f,g){A(f,n,g),l.m(f,g),A(f,o,g),I(s,f,g),r=!0},p(f,g){e=f,a!==(a=i(e))&&(l.d(1),l=a(e),l&&(l.c(),l.m(o.parentNode,o)));const d=g&2?Jt(u,[zo(e[4])]):{};s.$set(d)},i(f){r||(w(s.$$.fragment,f),r=!0)},o(f){S(s.$$.fragment,f),r=!1},d(f){f&&(v(n),v(o)),l.d(f),N(s,f)}}}function vl(t){let e=[],n=new Map,o,s,r=ue(t[1]);const i=a=>a[6];for(let a=0;a<r.length;a+=1){let l=xn(t,r,a),u=i(l);n.set(u,e[a]=to(u,l))}return{c(){for(let a=0;a<e.length;a+=1)e[a].c();o=te()},m(a,l){for(let u=0;u<e.length;u+=1)e[u]&&e[u].m(a,l);A(a,o,l),s=!0},p(a,l){l&2&&(r=ue(a[1]),re(),e=He(e,l,i,1,a,r,n,o.parentNode,ct,to,o,xn),ie())},i(a){if(!s){for(let l=0;l<r.length;l+=1)w(e[l]);s=!0}},o(a){for(let l=0;l<e.length;l+=1)S(e[l]);s=!1},d(a){a&&v(o);for(let l=0;l<e.length;l+=1)e[l].d(a)}}}function Al(t){let e,n,o;const s=t[3].bar,r=J(s,t,t[2],eo),i=r||Sl(t),a=t[3].icons,l=J(a,t,t[2],$n),u=l||vl(t);return{c(){e=P("div"),i&&i.c(),n=j(),u&&u.c(),y(e,"class","protyle-breadcrumb")},m(c,f){A(c,e,f),i&&i.m(e,null),L(e,n),u&&u.m(e,null),o=!0},p(c,[f]){r?r.p&&(!o||f&4)&&X(r,s,c,c[2],o?Y(s,c[2],f,kl):Q(c[2]),eo):i&&i.p&&(!o||f&1)&&i.p(c,o?f:-1),l?l.p&&(!o||f&4)&&X(l,a,c,c[2],o?Y(a,c[2],f,wl):Q(c[2]),$n):u&&u.p&&(!o||f&2)&&u.p(c,o?f:-1)},i(c){o||(w(i,c),w(u,c),o=!0)},o(c){S(i,c),S(u,c),o=!1},d(c){c&&v(e),i&&i.d(c),u&&u.d(c)}}}function Ol(t,e,n){let{$$slots:o={},$$scope:s}=e,{items:r=[]}=e,{icons:i=[]}=e;return t.$$set=a=>{"items"in a&&n(0,r=a.items),"icons"in a&&n(1,i=a.icons),"$$scope"in a&&n(2,s=a.$$scope)},[r,i,s,o]}class Pl extends ${constructor(e){super(),x(this,e,Ol,Al,z,{items:0,icons:1})}}const Cl=t=>({}),no=t=>({}),Bl=t=>({}),oo=t=>({});function so(t){let e,n;return e=new Pl({props:{items:t[2],icons:t[3]}}),{c(){R(e.$$.fragment)},m(o,s){I(e,o,s),n=!0},p(o,s){const r={};s&4&&(r.items=o[2]),s&8&&(r.icons=o[3]),e.$set(r)},i(o){n||(w(e.$$.fragment,o),n=!0)},o(o){S(e.$$.fragment,o),n=!1},d(o){N(e,o)}}}function Ll(t){let e,n,o=t[1]&&so(t);return{c(){o&&o.c(),e=te()},m(s,r){o&&o.m(s,r),A(s,e,r),n=!0},p(s,r){s[1]?o?(o.p(s,r),r&2&&w(o,1)):(o=so(s),o.c(),w(o,1),o.m(e.parentNode,e)):o&&(re(),S(o,1,1,()=>{o=null}),ie())},i(s){n||(w(o),n=!0)},o(s){S(o),n=!1},d(s){s&&v(e),o&&o.d(s)}}}function Dl(t){let e,n,o,s;const r=t[5].breadcrumb,i=J(r,t,t[4],oo),a=i||Ll(t),l=t[5].content,u=J(l,t,t[4],no);return{c(){e=P("div"),a&&a.c(),n=j(),o=P("div"),u&&u.c(),y(o,"class","protyle-preview"),y(e,"class","fn__flex-column"),k(e,"fullscreen",t[0])},m(c,f){A(c,e,f),a&&a.m(e,null),L(e,n),L(e,o),u&&u.m(o,null),s=!0},p(c,[f]){i?i.p&&(!s||f&16)&&X(i,r,c,c[4],s?Y(r,c[4],f,Bl):Q(c[4]),oo):a&&a.p&&(!s||f&14)&&a.p(c,s?f:-1),u&&u.p&&(!s||f&16)&&X(u,l,c,c[4],s?Y(l,c[4],f,Cl):Q(c[4]),no),(!s||f&1)&&k(e,"fullscreen",c[0])},i(c){s||(w(a,c),w(u,c),s=!0)},o(c){S(a,c),S(u,c),s=!1},d(c){c&&v(e),a&&a.d(c),u&&u.d(c)}}}function Il(t,e,n){let{$$slots:o={},$$scope:s}=e,{fullscreen:r=!1}=e,{breadcrumb:i=!0}=e,{breadcrumbItems:a=[]}=e,{breadcrumbIcons:l=[]}=e;return t.$$set=u=>{"fullscreen"in u&&n(0,r=u.fullscreen),"breadcrumb"in u&&n(1,i=u.breadcrumb),"breadcrumbItems"in u&&n(2,a=u.breadcrumbItems),"breadcrumbIcons"in u&&n(3,l=u.breadcrumbIcons),"$$scope"in u&&n(4,s=u.$$scope)},[r,i,a,l,s,o]}class Nl extends ${constructor(e){super(),x(this,e,Il,Dl,z,{fullscreen:0,breadcrumb:1,breadcrumbItems:2,breadcrumbIcons:3})}}function Rl(t){let e,n,o,s;return{c(){e=P("iframe"),Sn(e.src,n=t[0])||y(e,"src",n),y(e,"title",t[1]),y(e,"allow",t[2]),y(e,"csp",t[3]),y(e,"importance",t[4]),y(e,"name",t[5]),y(e,"referrerpolicy",t[6]),y(e,"sandbox",t[7]),y(e,"srcdoc",t[8]),y(e,"class","fn__flex fn__flex-1 iframe svelte-2g72x8")},m(r,i){A(r,e,i),t[11](e),o||(s=Wi(t[10].call(null,e)),o=!0)},p(r,[i]){i&1&&!Sn(e.src,n=r[0])&&y(e,"src",n),i&2&&y(e,"title",r[1]),i&4&&y(e,"allow",r[2]),i&8&&y(e,"csp",r[3]),i&16&&y(e,"importance",r[4]),i&32&&y(e,"name",r[5]),i&64&&y(e,"referrerpolicy",r[6]),i&128&&y(e,"sandbox",r[7]),i&256&&y(e,"srcdoc",r[8])},i:K,o:K,d(r){r&&v(e),t[11](null),o=!1,s()}}}function Ml(t,e,n){let{src:o=void 0}=e,{title:s=void 0}=e;const r=lt();let i,{allow:a=void 0}=e,{csp:l=void 0}=e,{importance:u=void 0}=e,{name:c=void 0}=e,{referrerpolicy:f=void 0}=e,{sandbox:g=void 0}=e,{srcdoc:d=void 0}=e;const h=p=>(r("create",{iframe:p}),{update(C){r("update",{iframe:i})},destroy(){r("destroy")}});function b(p){$e[p?"unshift":"push"](()=>{i=p,n(9,i)})}return t.$$set=p=>{"src"in p&&n(0,o=p.src),"title"in p&&n(1,s=p.title),"allow"in p&&n(2,a=p.allow),"csp"in p&&n(3,l=p.csp),"importance"in p&&n(4,u=p.importance),"name"in p&&n(5,c=p.name),"referrerpolicy"in p&&n(6,f=p.referrerpolicy),"sandbox"in p&&n(7,g=p.sandbox),"srcdoc"in p&&n(8,d=p.srcdoc)},[o,s,a,l,u,c,f,g,d,i,h,b]}class jl extends ${constructor(e){super(),x(this,e,Ml,Rl,z,{src:0,title:1,allow:2,csp:3,importance:4,name:5,referrerpolicy:6,sandbox:7,srcdoc:8})}}function Go(t){const e=globalThis.document.createElement("a");return e.href=t,new URL(e.href)}function Yt(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Fl=function(){var t=document.getSelection();if(!t.rangeCount)return function(){};for(var e=document.activeElement,n=[],o=0;o<t.rangeCount;o++)n.push(t.getRangeAt(o));switch(e.tagName.toUpperCase()){case"INPUT":case"TEXTAREA":e.blur();break;default:e=null;break}return t.removeAllRanges(),function(){t.type==="Caret"&&t.removeAllRanges(),t.rangeCount||n.forEach(function(s){t.addRange(s)}),e&&e.focus()}},Ul=Fl,ro={"text/plain":"Text","text/html":"Url",default:"Text"},ql="Copy to clipboard: #{key}, Enter";function Wl(t){var e=(/mac os x/i.test(navigator.userAgent)?"⌘":"Ctrl")+"+C";return t.replace(/#{\s*key\s*}/g,e)}function Kl(t,e){var n,o,s,r,i,a,l=!1;e||(e={}),n=e.debug||!1;try{s=Ul(),r=document.createRange(),i=document.getSelection(),a=document.createElement("span"),a.textContent=t,a.ariaHidden="true",a.style.all="unset",a.style.position="fixed",a.style.top=0,a.style.clip="rect(0, 0, 0, 0)",a.style.whiteSpace="pre",a.style.webkitUserSelect="text",a.style.MozUserSelect="text",a.style.msUserSelect="text",a.style.userSelect="text",a.addEventListener("copy",function(c){if(c.stopPropagation(),e.format)if(c.preventDefault(),typeof c.clipboardData>"u"){n&&console.warn("unable to use e.clipboardData"),n&&console.warn("trying IE specific stuff"),window.clipboardData.clearData();var f=ro[e.format]||ro.default;window.clipboardData.setData(f,t)}else c.clipboardData.clearData(),c.clipboardData.setData(e.format,t);e.onCopy&&(c.preventDefault(),e.onCopy(c.clipboardData))}),document.body.appendChild(a),r.selectNodeContents(a),i.addRange(r);var u=document.execCommand("copy");if(!u)throw new Error("copy command was unsuccessful");l=!0}catch(c){n&&console.error("unable to copy using execCommand: ",c),n&&console.warn("trying IE specific stuff");try{window.clipboardData.setData(e.format||"text",t),e.onCopy&&e.onCopy(window.clipboardData),l=!0}catch(f){n&&console.error("unable to copy using clipboardData: ",f),n&&console.error("falling back to prompt"),o=Wl("message"in e?e.message:ql),window.prompt(o,t)}}finally{i&&(typeof i.removeRange=="function"?i.removeRange(r):i.removeAllRanges()),a&&document.body.removeChild(a),s()}return l}var Hl=Kl;const zl=Yt(Hl);function Gl(t){if(navigator.clipboard&&window.isSecureContext)return navigator.clipboard.writeText(t);zl(t)}function Vl(t,e){return t.startsWith(e)?t.slice(e.length):t}const Jl=new Map([["stage","iconFolder"],["assets","iconImage"],["assets","iconImage"],["emojies","iconEmoji"],["plugins","iconPlugin"],["public","iconCloud"],["snippets","iconCode"],["templates","iconMarkdown"],["widgets","iconBoth"],["appearance","iconTheme"],["export","iconUpload"],["history","iconHistory"]]);function Yl(t){return Jl.get(t)??"iconHelp"}function Xl(t){let e,n;return e=new jl({props:{src:t[0],title:t[1],slot:"content"}}),e.$on("create",t[5]),e.$on("destroy",t[6]),{c(){R(e.$$.fragment)},m(o,s){I(e,o,s),n=!0},p(o,s){const r={};s&1&&(r.src=o[0]),s&2&&(r.title=o[1]),e.$set(r)},i(o){n||(w(e.$$.fragment,o),n=!0)},o(o){S(e.$$.fragment,o),n=!1},d(o){N(e,o)}}}function Ql(t){let e,n;return e=new Nl({props:{fullscreen:t[2],breadcrumb:Zl,breadcrumbItems:t[3],breadcrumbIcons:t[4],$$slots:{content:[Xl]},$$scope:{ctx:t}}}),{c(){R(e.$$.fragment)},m(o,s){I(e,o,s),n=!0},p(o,[s]){const r={};s&4&&(r.fullscreen=o[2]),s&8&&(r.breadcrumbItems=o[3]),s&1027&&(r.$$scope={dirty:s,ctx:o}),e.$set(r)},i(o){n||(w(e.$$.fragment,o),n=!0)},o(o){S(e.$$.fragment,o),n=!1},d(o){N(e,o)}}}let Zl=!0;function xl(t,e,n){var d,h,b,p,C,G,ne,T;let o,{src:s}=e,{title:r}=e,i,a=!1,l=[],u=[{icon:"#iconCopy",type:"copy",ariaLabel:(h=(d=globalThis.siyuan)==null?void 0:d.languages)==null?void 0:h.copy,tooltipsDirection:be.sw,onClick(M,q,E){Gl(o.href)}},{icon:"#iconRefresh",type:"refresh",ariaLabel:(p=(b=globalThis.siyuan)==null?void 0:b.languages)==null?void 0:p.refresh,tooltipsDirection:be.sw,onClick(M,q,E){var H,U;(U=(H=i==null?void 0:i.contentWindow)==null?void 0:H.location)!=null&&U.reload?i.contentWindow.location.reload():n(0,s)}},{icon:"#iconOpenWindow",type:"open",ariaLabel:(G=(C=globalThis.siyuan)==null?void 0:C.languages)==null?void 0:G.useBrowserView,tooltipsDirection:be.sw,onClick(M,q,E){globalThis.open(s)}},{icon:"#iconFullscreen",type:"fullscreen",ariaLabel:(T=(ne=globalThis.siyuan)==null?void 0:ne.languages)==null?void 0:T.fullscreen,tooltipsDirection:be.sw,onClick(M,q,E){var U;const H=(E.active&&Ui(E.active))??a;n(2,a=!H),(U=E.active)==null||U.set(a)}}];function c(M){const q=[],E=[],H=M.origin===location.origin;q.push(`${M.protocol}//`),E.push({type:"item",get icon(){switch(M.protocol){case"https:":case"ftps:":return"#iconLock";case"http:":case"ftp:":return"#iconUnlock";default:return"#iconHelp"}},text:`${M.protocol}//`,textTitle:q.join(""),textEllipsis:!1},{type:"arrow"}),q.push(M.host),E.push({type:"item",get icon(){return H?"#iconSiYuan":"#iconLanguage"},text:M.host,textTitle:q.join(""),textEllipsis:!1,active:!0}),M.pathname.split("/").forEach((U,Ee)=>{U&&(q.push(`/${U}`),E.push({type:"arrow",icon:"#icon-keepass-slash"},{type:"item",icon:Ee===1&&H?`#${Yl(U)}`:void 0,text:U,textTitle:q.join(""),textEllipsis:!1}))}),M.search&&(q.push(M.search),E.push({type:"arrow"},{type:"item",text:M.search,textTitle:q.join(""),textEllipsis:!1,active:!1})),M.hash&&(q.push(M.hash),E.push({type:"arrow"},{type:"item",text:M.hash,textTitle:q.join(""),textEllipsis:!1,active:!1})),n(3,l=E)}function f(M){i=M.detail.iframe}function g(M){i=void 0}return t.$$set=M=>{"src"in M&&n(0,s=M.src),"title"in M&&n(1,r=M.title)},t.$$.update=()=>{t.$$.dirty&1&&n(7,o=Go(s)),t.$$.dirty&128&&c(o)},[s,r,a,l,u,f,g,o]}class $l extends ${constructor(e){super(),x(this,e,xl,Ql,z,{src:0,title:1})}}ec();nc();const kt=tc();function ec(){switch(ge.getFrontend()){case"desktop":case"desktop-window":case"browser-desktop":return!0;case"mobile":case"browser-mobile":return!1;default:return!1}}function tc(){switch(ge.getFrontend()){case"mobile":case"browser-mobile":return!0;case"desktop":case"desktop-window":case"browser-desktop":return!1;default:return!1}}function nc(){switch(ge.getFrontend()){case"browser-desktop":case"browser-mobile":return!0;case"desktop":case"desktop-window":case"mobile":return!1;default:return!1}}class oc{constructor(e,n=!0){this.label=e,this.collapsed=n}stdout(e,n,...o){const s=`[\x1B[4m${this.label}\x1B[0m] - <\x1B[1m${e.name.toUpperCase()}\x1B[0m>`;if(this.collapsed?globalThis.console.groupCollapsed(s):globalThis.console.group(s),n)for(const r of o)Array.isArray(r)?e(...r):e(r);else e(...o);globalThis.console.trace(),globalThis.console.groupEnd()}dir(...e){this.stdout(globalThis.console.dir,!1,...e)}dirs(...e){this.stdout(globalThis.console.dir,!0,...e)}table(...e){this.stdout(globalThis.console.table,!1,...e)}tables(...e){this.stdout(globalThis.console.table,!0,...e)}debug(...e){this.stdout(globalThis.console.debug,!1,...e)}debugs(...e){this.stdout(globalThis.console.debug,!0,...e)}info(...e){this.stdout(globalThis.console.info,!1,...e)}infos(...e){this.stdout(globalThis.console.info,!0,...e)}log(...e){this.stdout(globalThis.console.log,!1,...e)}logs(...e){this.stdout(globalThis.console.log,!0,...e)}warn(...e){this.stdout(globalThis.console.warn,!1,...e)}warns(...e){this.stdout(globalThis.console.warn,!0,...e)}error(...e){this.stdout(globalThis.console.error,!1,...e)}errors(...e){this.stdout(globalThis.console.error,!0,...e)}}var sc=function(e){return rc(e)&&!ic(e)};function rc(t){return!!t&&typeof t=="object"}function ic(t){var e=Object.prototype.toString.call(t);return e==="[object RegExp]"||e==="[object Date]"||cc(t)}var ac=typeof Symbol=="function"&&Symbol.for,lc=ac?Symbol.for("react.element"):60103;function cc(t){return t.$$typeof===lc}function uc(t){return Array.isArray(t)?[]:{}}function qe(t,e){return e.clone!==!1&&e.isMergeableObject(t)?Le(uc(t),t,e):t}function fc(t,e,n){return t.concat(e).map(function(o){return qe(o,n)})}function hc(t,e){if(!e.customMerge)return Le;var n=e.customMerge(t);return typeof n=="function"?n:Le}function dc(t){return Object.getOwnPropertySymbols?Object.getOwnPropertySymbols(t).filter(function(e){return Object.propertyIsEnumerable.call(t,e)}):[]}function io(t){return Object.keys(t).concat(dc(t))}function Vo(t,e){try{return e in t}catch{return!1}}function pc(t,e){return Vo(t,e)&&!(Object.hasOwnProperty.call(t,e)&&Object.propertyIsEnumerable.call(t,e))}function mc(t,e,n){var o={};return n.isMergeableObject(t)&&io(t).forEach(function(s){o[s]=qe(t[s],n)}),io(e).forEach(function(s){pc(t,s)||(Vo(t,s)&&n.isMergeableObject(e[s])?o[s]=hc(s,n)(t[s],e[s],n):o[s]=qe(e[s],n))}),o}function Le(t,e,n){n=n||{},n.arrayMerge=n.arrayMerge||fc,n.isMergeableObject=n.isMergeableObject||sc,n.cloneUnlessOtherwiseSpecified=qe;var o=Array.isArray(e),s=Array.isArray(t),r=o===s;return r?o?n.arrayMerge(t,e,n):mc(t,e,n):qe(e,n)}Le.all=function(e,n){if(!Array.isArray(e))throw new Error("first argument should be an array");return e.reduce(function(o,s){return Le(o,s,n)},{})};var gc=Le,bc=gc;const _c=Yt(bc);function Ve(...t){return _c.all(t,{arrayMerge:(e,n,o)=>n})}function le(t){if(typeof t!="string")throw new TypeError("Path must be a string. Received "+JSON.stringify(t))}function ao(t,e){for(var n="",o=0,s=-1,r=0,i,a=0;a<=t.length;++a){if(a<t.length)i=t.charCodeAt(a);else{if(i===47)break;i=47}if(i===47){if(!(s===a-1||r===1))if(s!==a-1&&r===2){if(n.length<2||o!==2||n.charCodeAt(n.length-1)!==46||n.charCodeAt(n.length-2)!==46){if(n.length>2){var l=n.lastIndexOf("/");if(l!==n.length-1){l===-1?(n="",o=0):(n=n.slice(0,l),o=n.length-1-n.lastIndexOf("/")),s=a,r=0;continue}}else if(n.length===2||n.length===1){n="",o=0,s=a,r=0;continue}}e&&(n.length>0?n+="/..":n="..",o=2)}else n.length>0?n+="/"+t.slice(s+1,a):n=t.slice(s+1,a),o=a-s-1;s=a,r=0}else i===46&&r!==-1?++r:r=-1}return n}function yc(t,e){var n=e.dir||e.root,o=e.base||(e.name||"")+(e.ext||"");return n?n===e.root?n+o:n+t+o:o}var Ce={resolve:function(){for(var e="",n=!1,o,s=arguments.length-1;s>=-1&&!n;s--){var r;s>=0?r=arguments[s]:(o===void 0&&(o=process.cwd()),r=o),le(r),r.length!==0&&(e=r+"/"+e,n=r.charCodeAt(0)===47)}return e=ao(e,!n),n?e.length>0?"/"+e:"/":e.length>0?e:"."},normalize:function(e){if(le(e),e.length===0)return".";var n=e.charCodeAt(0)===47,o=e.charCodeAt(e.length-1)===47;return e=ao(e,!n),e.length===0&&!n&&(e="."),e.length>0&&o&&(e+="/"),n?"/"+e:e},isAbsolute:function(e){return le(e),e.length>0&&e.charCodeAt(0)===47},join:function(){if(arguments.length===0)return".";for(var e,n=0;n<arguments.length;++n){var o=arguments[n];le(o),o.length>0&&(e===void 0?e=o:e+="/"+o)}return e===void 0?".":Ce.normalize(e)},relative:function(e,n){if(le(e),le(n),e===n||(e=Ce.resolve(e),n=Ce.resolve(n),e===n))return"";for(var o=1;o<e.length&&e.charCodeAt(o)===47;++o);for(var s=e.length,r=s-o,i=1;i<n.length&&n.charCodeAt(i)===47;++i);for(var a=n.length,l=a-i,u=r<l?r:l,c=-1,f=0;f<=u;++f){if(f===u){if(l>u){if(n.charCodeAt(i+f)===47)return n.slice(i+f+1);if(f===0)return n.slice(i+f)}else r>u&&(e.charCodeAt(o+f)===47?c=f:f===0&&(c=0));break}var g=e.charCodeAt(o+f),d=n.charCodeAt(i+f);if(g!==d)break;g===47&&(c=f)}var h="";for(f=o+c+1;f<=s;++f)(f===s||e.charCodeAt(f)===47)&&(h.length===0?h+="..":h+="/..");return h.length>0?h+n.slice(i+c):(i+=c,n.charCodeAt(i)===47&&++i,n.slice(i))},_makeLong:function(e){return e},dirname:function(e){if(le(e),e.length===0)return".";for(var n=e.charCodeAt(0),o=n===47,s=-1,r=!0,i=e.length-1;i>=1;--i)if(n=e.charCodeAt(i),n===47){if(!r){s=i;break}}else r=!1;return s===-1?o?"/":".":o&&s===1?"//":e.slice(0,s)},basename:function(e,n){if(n!==void 0&&typeof n!="string")throw new TypeError('"ext" argument must be a string');le(e);var o=0,s=-1,r=!0,i;if(n!==void 0&&n.length>0&&n.length<=e.length){if(n.length===e.length&&n===e)return"";var a=n.length-1,l=-1;for(i=e.length-1;i>=0;--i){var u=e.charCodeAt(i);if(u===47){if(!r){o=i+1;break}}else l===-1&&(r=!1,l=i+1),a>=0&&(u===n.charCodeAt(a)?--a===-1&&(s=i):(a=-1,s=l))}return o===s?s=l:s===-1&&(s=e.length),e.slice(o,s)}else{for(i=e.length-1;i>=0;--i)if(e.charCodeAt(i)===47){if(!r){o=i+1;break}}else s===-1&&(r=!1,s=i+1);return s===-1?"":e.slice(o,s)}},extname:function(e){le(e);for(var n=-1,o=0,s=-1,r=!0,i=0,a=e.length-1;a>=0;--a){var l=e.charCodeAt(a);if(l===47){if(!r){o=a+1;break}continue}s===-1&&(r=!1,s=a+1),l===46?n===-1?n=a:i!==1&&(i=1):n!==-1&&(i=-1)}return n===-1||s===-1||i===0||i===1&&n===s-1&&n===o+1?"":e.slice(n,s)},format:function(e){if(e===null||typeof e!="object")throw new TypeError('The "pathObject" argument must be of type Object. Received type '+typeof e);return yc("/",e)},parse:function(e){le(e);var n={root:"",dir:"",base:"",ext:"",name:""};if(e.length===0)return n;var o=e.charCodeAt(0),s=o===47,r;s?(n.root="/",r=1):r=0;for(var i=-1,a=0,l=-1,u=!0,c=e.length-1,f=0;c>=r;--c){if(o=e.charCodeAt(c),o===47){if(!u){a=c+1;break}continue}l===-1&&(u=!1,l=c+1),o===46?i===-1?i=c:f!==1&&(f=1):i!==-1&&(f=-1)}return i===-1||l===-1||f===0||f===1&&i===l-1&&i===a+1?l!==-1&&(a===0&&s?n.base=n.name=e.slice(1,l):n.base=n.name=e.slice(a,l)):(a===0&&s?(n.name=e.slice(1,i),n.base=e.slice(1,l)):(n.name=e.slice(a,i),n.base=e.slice(a,l)),n.ext=e.slice(i,l)),a>0?n.dir=e.slice(0,a-1):s&&(n.dir="/"),n},sep:"/",delimiter:":",win32:null,posix:null};Ce.posix=Ce;var wc=Ce;const kc=Yt(wc);function ee(...t){return kc.join(...t)}function lo(t){return Array.isArray(t)?new Set(t):t}function Sc(t,e){return new Set([...t].filter(n=>e.has(n)))}function co(t,e){return new Set([...t].filter(n=>!e.has(n)))}function St(t,e){const n=lo(t),o=lo(e);return{insert:co(n,o),update:Sc(n,o),delete:co(o,n)}}const Jo=Ac();Yo();Oc();function Ec(){return!!globalThis.require}function Tc(){return!!globalThis.process}function vc(){var t,e;return!!((e=(t=globalThis.process)==null?void 0:t.versions)!=null&&e.hasOwnProperty("electron"))}function Ac(){return Tc()&&Ec()&&vc()}function Yo(){var n,o,s,r,i,a;switch((s=(o=(n=globalThis==null?void 0:globalThis.document)==null?void 0:n.documentElement)==null?void 0:o.dataset)==null?void 0:s.themeMode){case"light":return!0;case"dark":return!1}switch((a=(i=(r=globalThis==null?void 0:globalThis.siyuan)==null?void 0:r.config)==null?void 0:i.appearance)==null?void 0:a.mode){case 0:return!0;case 1:return!1}return window.matchMedia("(prefers-color-scheme: light)").matches}function Oc(){return!Yo()}function Pc(t=!0,e=(n=>(n=globalThis.process)==null?void 0:n.platform)()==="darwin"){const o=[{role:"about"},...e?[{type:"separator"},{role:"help"},{type:"separator"},{role:"services"},{type:"separator"},{role:"hide"},{role:"hideOthers"},{role:"unhide"}]:[],{type:"separator"},{role:"quit"}],s=[...e?[{role:"recentDocuments"},{role:"clearRecentDocuments"},{type:"separator"}]:[],{role:"close"}],r=[{role:"undo"},{role:"redo"},{type:"separator"},{role:"cut"},{role:"copy"},{role:"paste"},{role:"pasteAndMatchStyle"},{role:"delete"},{type:"separator"},{role:"selectAll"},{type:"separator"},{role:"toggleSpellChecker"},...e?[{type:"separator"},{role:"showSubstitutions"},{role:"toggleTextReplacement"},{type:"separator"},{role:"toggleSmartQuotes"},{role:"toggleSmartDashes"},{type:"separator"},{role:"startSpeaking"},{role:"stopSpeaking"}]:[]],i=[{role:"reload"},{role:"forceReload"},{type:"separator"},{role:"resetZoom"},{role:"zoomIn",accelerator:"CmdOrCtrl+="},{role:"zoomOut"},...e?[{role:"zoom"},{type:"separator"},{role:"front"}]:[{type:"separator"},{label:"Toggle On Top",click:(u,c,f)=>{c&&c.setAlwaysOnTop(!c.isAlwaysOnTop())},type:"checkbox",checked:t,accelerator:"CmdOrCtrl+Shift+Space"}],{role:"togglefullscreen"},{type:"separator"},{role:"toggleDevTools"}],a=[...e?[{role:"window"},{type:"separator"},{role:"toggleTabBar"},{role:"selectNextTab"},{role:"selectPreviousTab"},{role:"mergeAllWindows"},{role:"moveTabToNewWindow"},{type:"separator"}]:[],{role:"minimize"},{role:"close"}],l=[{role:"appMenu",submenu:o},{role:"fileMenu",submenu:s},{role:"editMenu",submenu:r},{role:"viewMenu",submenu:i},{role:"windowMenu",submenu:a}];return e&&l.push({role:"shareMenu"}),l}function Cc(t){var s,r,i,a;t.base.center&&(delete t.base.x,delete t.base.y);const{BrowserWindow:e,Menu:n}=globalThis.require("@electron/remote"),o=new e(t.base);if((s=t.extra)!=null&&s.enableMenuBar)if((r=t.extra)!=null&&r.menu)o.setMenu(t.extra.menu);else{const l=n.buildFromTemplate(Pc(t.base.alwaysOnTop));o.setMenu(l)}else o.removeMenu();return(i=t.extra)!=null&&i.enableElectron&&globalThis.require("@electron/remote").require("@electron/remote/main").enable(o.webContents),o.loadURL(t.url.toString(),(a=t.extra)==null?void 0:a.loadURLOptions),o}function Bc(t){var o,s,r;t.base.center&&(t.base.width&&(t.base.x=(globalThis.screen.width-t.base.width)/2),t.base.height&&(t.base.y=(globalThis.screen.height-t.base.height)/2));const e=["popup = true"];return t.base.x!==void 0&&e.push(`left = ${t.base.x}`),t.base.y!==void 0&&e.push(`top = ${t.base.y}`),t.base.width!==void 0&&e.push(`width = ${t.base.width}`),t.base.height!==void 0&&e.push(`height = ${t.base.height}`),((o=t.extra)==null?void 0:o.noopener)!==void 0&&e.push(`noopener = ${t.extra.noopener}`),((s=t.extra)==null?void 0:s.noreferrer)!==void 0&&e.push(`noreferrer = ${t.extra.noreferrer}`),globalThis.open(t.url.toString(),(r=t.extra)==null?void 0:r.target,e.join(", "))}function Lc(t){return Jo?Cc(t):Bc(t)}var Xt=!1;globalThis.document.documentElement.addEventListener("blur",()=>Xt=!1);globalThis.document.documentElement.addEventListener("focus",()=>Xt=!0);function Dc(){return Jo?!globalThis.document.body.classList.contains("body--blur"):Xt}const Je={keeweb:{plugin:{siyuan:{enable:!0}}},window:{width:800,height:600,center:!1,alwaysOnTop:!0}},O=class O extends ge.Plugin{constructor(n){super(n);B(this,"siyuan",ge);B(this,"logger");B(this,"client");B(this,"SETTINGS_DIALOG_ID");B(this,"TOP_BAR_MENU_ID");B(this,"KEEWEB_BASE_PATHNAME");B(this,"KEEWEB_INDEX_PATHNAME");B(this,"KEEWEB_PLUGIN_PATHANEM");B(this,"KEEWEB_INDEX_URL");B(this,"PLUGIN_INSTALL_PATH");B(this,"PLUGIN_STORAGE_PATH");B(this,"PLUGIN_STORAGE_IDB_PATH");B(this,"CUSTOM_TAB_ID_KEEWEB");B(this,"keewebTab");B(this,"manifest");B(this,"config",Ve(Je));B(this,"local",{});B(this,"idb");B(this,"topBarButton");B(this,"storageEventListener",async n=>{if(n.storageArea===globalThis.localStorage){let o=!1;if(n.key===null)this.local={},o=!0;else if(this.isLocalStorageKey(n.key))switch(n.newValue===null?(delete this.local[n.key],o=!0):(this.local[n.key]=JSON.parse(n.newValue),o=!0),n.key){case O.LOCAL_STORAGE_KEY_PLUGINS:this.saveKeeWebPluginConfig(),await this.saveIDB(O.IDB_SCHEMA.PluginFiles.name);break;case O.LOCAL_STORAGE_KEY_FILE_INFO:await this.saveIDB(O.IDB_SCHEMA.FilesCache.name);break}o&&await this.saveLocal()}});B(this,"openKeeWebTab",async()=>{ge.openTab({app:this.app,custom:{icon:"icon-keepass-keeweb",title:"KeeWeb",id:this.CUSTOM_TAB_ID_KEEWEB,data:{src:Vl(this.KEEWEB_INDEX_URL.href,globalThis.document.baseURI),title:"KeeWeb"}},keepCursor:!1,removeCurrentTab:!1})});B(this,"openKeeWebBrowser",async()=>{globalThis.open(this.KEEWEB_INDEX_URL.href)});B(this,"openKeeWebWindow",async(n=!Dc())=>{var o,s;Lc({url:this.KEEWEB_INDEX_URL,base:{center:n||this.config.window.center,width:this.config.window.width,height:this.config.window.height,alwaysOnTop:this.config.window.alwaysOnTop,x:((o=globalThis.siyuan.coordinates)==null?void 0:o.screenX)??0,y:((s=globalThis.siyuan.coordinates)==null?void 0:s.screenY)??0},extra:{enableMenuBar:!0}})});const o=new URL(globalThis.document.baseURI);this.logger=new oc(this.name),this.client=new Ni(void 0,"fetch"),this.SETTINGS_DIALOG_ID=`${this.name}-settings-dialog`,this.TOP_BAR_MENU_ID=`${this.name}-top-bar-menu`,this.KEEWEB_BASE_PATHNAME=ee(o.pathname,"plugins",this.name,"keeweb"),this.KEEWEB_INDEX_PATHNAME=ee(this.KEEWEB_BASE_PATHNAME,"app"),this.KEEWEB_PLUGIN_PATHANEM=ee(this.KEEWEB_BASE_PATHNAME,"plugins/siyuan"),this.KEEWEB_INDEX_URL=Go(`${this.KEEWEB_INDEX_PATHNAME}/?v=${ls.version}`),this.PLUGIN_INSTALL_PATH=`/data/plugins/${this.name}`,this.PLUGIN_STORAGE_PATH=`/data/storage/petal/${this.name}`,this.PLUGIN_STORAGE_IDB_PATH=ee(this.PLUGIN_STORAGE_PATH,"idb"),this.CUSTOM_TAB_ID_KEEWEB=`${this.name}${O.CUSTOM_TAB_TYPE_KEEWEB}`,this.keewebTab=this.addTab({type:O.CUSTOM_TAB_TYPE_KEEWEB,init(){const s=this;s.component=new $l({target:s.element,props:{...s.data}})},destroy(){var r;(r=this.component)==null||r.$destroy()}})}static iterateIDB(n=O.IDB_SCHEMA){const o=[];for(const[s,r]of Object.entries(n))for(const i of Object.keys(r.stores))o.push({db:s,store:i});return o}onload(){this.addIcons([Ri,Mi].join("")),this.addCommand({langKey:"open-keeweb-tab",langText:this.i18n.menu.command.openKeeWebTab.text,hotkey:"⌥⌘K",customHotkey:"",callback:this.openKeeWebTab}),this.addCommand({langKey:"open-keeweb-browser",langText:this.i18n.menu.command.openKeeWebBrowser.text,hotkey:"",customHotkey:"",callback:this.openKeeWebBrowser}),this.addCommand({langKey:"open-keeweb-window",langText:this.i18n.menu.command.openKeeWebWindow.text,hotkey:"⌥⇧K",customHotkey:"",globalCallback:()=>{this.openKeeWebWindow()}}),this.loadData(O.GLOBAL_CONFIG_NAME).then(n=>{n?this.config=Ve(Je,n):this.config=Ve(Je)}).catch(n=>this.logger.error(n)).finally(async()=>{await this.initIDB(),await this.initFiles(),await this.loadIDB(),await this.loadLocalStorage(),await this.updateKeeWebPluginStatus(),globalThis.addEventListener("storage",this.storageEventListener)})}onLayoutReady(){this.topBarButton=this.addTopBar({icon:"icon-keepass-keeweb",title:this.displayName,position:"right",callback:n=>{var s,r,i,a;const o=new ge.Menu(this.TOP_BAR_MENU_ID);o.addItem({icon:"iconLayout",label:this.i18n.menu.command.openKeeWebTab.text,click:this.openKeeWebTab}),o.addItem({icon:"iconLanguage",label:this.i18n.menu.command.openKeeWebBrowser.text,click:this.openKeeWebBrowser}),o.addItem({icon:"iconOpenWindow",label:this.i18n.menu.command.openKeeWebWindow.text,click:()=>this.openKeeWebWindow(!1)}),kt?o.fullscreen():o.open({x:((r=(s=globalThis.siyuan)==null?void 0:s.coordinates)==null?void 0:r.pageX)??0,y:((a=(i=globalThis.siyuan)==null?void 0:i.coordinates)==null?void 0:a.pageY)??0,isLeft:!0})}})}onunload(){globalThis.removeEventListener("storage",this.storageEventListener),this.saveLocalStorage(),this.saveIDB()}openSetting(){const n=this,s=new ge.Dialog({title:`${this.displayName} <code class="fn__code">${this.name}</code>`,content:`<div id="${n.SETTINGS_DIALOG_ID}" class="fn__flex-column" />`,width:kt?"92vw":"720px",height:kt?void 0:"640px"}).element.querySelector(`#${n.SETTINGS_DIALOG_ID}`);s&&new rl({target:s,props:{config:this.config,plugin:this}})}async initIDB(){this.idb={FilesCache:await xt(O.IDB_SCHEMA.FilesCache.name,void 0,this.createOpenDBCallbacks(O.IDB_SCHEMA.FilesCache.name)),PluginFiles:await xt(O.IDB_SCHEMA.PluginFiles.name,void 0,this.createOpenDBCallbacks(O.IDB_SCHEMA.PluginFiles.name))}}async initFiles(){await Promise.allSettled(O.IDB_ENTRIES.map(({db:n,store:o})=>this.client.putFile({path:ee(this.PLUGIN_STORAGE_IDB_PATH,n,o),isDir:!0}))),await this.loadKeeWebPluginManifest()}async resetConfig(){return this.updateConfig(Ve(Je))}async updateConfig(n){return n&&n!==this.config&&(this.config=n),await this.updateKeeWebPluginStatus(),this.saveData(O.GLOBAL_CONFIG_NAME,JSON.stringify(this.config,void 0,4))}async deleteKeeWebUserConfig(){this.removeLocalStorageItems(),await Promise.allSettled([this.idb.FilesCache.clear(O.IDB_SCHEMA.FilesCache.stores.files.name),this.idb.PluginFiles.clear(O.IDB_SCHEMA.PluginFiles.stores.files.name)]),await Promise.allSettled([this.saveLocalStorage(),this.saveIDB()]),await this.updateKeeWebPluginStatus()}async updateKeeWebPluginStatus(){switch(!0){case(!this.isKeeWebSiyuanPluginInstalled&&this.config.keeweb.plugin.siyuan.enable):await this.installKeeWebPlugin();break;case(this.isKeeWebSiyuanPluginInstalled&&!this.config.keeweb.plugin.siyuan.enable):await this.uninstallKeeWebPlugin();break}}async loadLocalStorage(){const n=await this.loadLocal(),o=this.getLocalStorageItems(),s=Object.keys(n),r=Object.keys(o);return St(s,r).delete.forEach(a=>globalThis.localStorage.removeItem(a)),this.setLocalStorageItems(this.local),n}async saveLocalStorage(){return this.local=this.getLocalStorageItems(),this.saveLocal(this.local)}async loadLocal(){try{const n=await this.loadData(O.LOCAL_STORAGE_NAME);return this.local=n instanceof Object?n:{},this.local}catch(n){throw this.logger.error(n),n}}async saveLocal(n=this.local){try{return await this.saveData(O.LOCAL_STORAGE_NAME,JSON.stringify(n,void 0,4)),!0}catch(o){return this.logger.error(o),!1}}setLocalStorageItem(n,o){globalThis.localStorage.setItem(n,JSON.stringify(o))}setLocalStorageItems(n=this.local){for(const[o,s]of Object.entries(n))this.setLocalStorageItem(o,s)}getLocalStorageItem(n){const o=globalThis.localStorage.getItem(n);return o===null?o:JSON.parse(o)}getLocalStorageItems(){const n={};for(const[o,s]of Object.entries(globalThis.localStorage))this.isLocalStorageKey(o)&&(n[o]=JSON.parse(s));return n}removeLocalStorageItems(){for(const n of Object.keys(globalThis.localStorage))this.isLocalStorageKey(n)&&globalThis.localStorage.removeItem(n)}async loadIDB(){for(const n of O.IDB_ENTRIES)try{const o=ee(this.PLUGIN_STORAGE_IDB_PATH,n.db,n.store),r=(await this.client.readDir({path:o})).data.filter(f=>!f.isDir).map(f=>f.name),i=await this.idb[n.db].getAllKeys(n.store),a=St(r,i),l=this.idb[n.db].transaction(n.store,"readwrite"),u=l.objectStore(n.store);(await Promise.allSettled([...[...a.delete].map(f=>u.delete(f)),...r.map(f=>(async()=>{const g=await this.client.getFile({path:ee(o,f)},"arraybuffer");await this.idb[n.db].put(n.store,g,f)})()),l.done])).forEach(f=>{f.status==="rejected"&&this.logger.warn(f.reason)})}catch(o){this.logger.warn(o)}}async saveIDB(...n){const o=new Set(n),s=o.size>0?O.IDB_ENTRIES.filter(r=>o.has(r.db)):O.IDB_ENTRIES;for(const r of s)try{const i=ee(this.PLUGIN_STORAGE_IDB_PATH,r.db,r.store),l=(await this.client.readDir({path:i})).data.filter(h=>!h.isDir).map(h=>h.name),u=await this.idb[r.db].getAllKeys(r.store),c=St(u,l),f=this.idb[r.db].transaction(r.store),g=f.objectStore(r.store);(await Promise.allSettled([...[...c.delete].map(h=>this.client.removeFile({path:ee(i,h)})),...u.map(h=>(async()=>{const b=await g.get(h);return b?this.client.putFile({path:ee(i,h),file:b}):void 0})()),f.done])).forEach(h=>{h.status==="rejected"&&this.logger.warn(h.reason)})}catch(i){this.logger.warn(i)}}isLocalStorageKey(n,o=O.LOCAL_STORAGE_KEY_PREFIX){return n.startsWith(o)}createOpenDBCallbacks(n){return{upgrade(o){for(const[s,r]of Object.entries(O.IDB_SCHEMA[n].stores))o.createObjectStore(r.name)}}}async copyKeeWebPluginFile(n){const o=`plugin.${n}`,s=ee(this.PLUGIN_INSTALL_PATH,"keeweb/plugins/siyuan",o),r=await this.client.getFile({path:s},"blob");return this.client.putFile({path:ee(this.PLUGIN_STORAGE_IDB_PATH,O.IDB_SCHEMA.PluginFiles.name,O.IDB_SCHEMA.PluginFiles.stores.files.name,`siyuan_${o}`),file:r})}async putKeeWebPluginFile(n){const o=`plugin.${n}`,s=`${this.manifest.name}_${o}`,r=ee(this.PLUGIN_INSTALL_PATH,"keeweb/plugins/siyuan",o),i=await this.client.getFile({path:r},"arraybuffer");await this.idb.PluginFiles.put(O.IDB_SCHEMA.PluginFiles.stores.files.name,i,s)}async deleteKeeWebPluginFile(n){const o=`${this.manifest.name}_plugin.${n}`;await this.idb.PluginFiles.delete(O.IDB_SCHEMA.PluginFiles.stores.files.name,o)}async loadKeeWebPluginManifest(){return this.manifest||(this.manifest=await this.client.getFile({path:ee(this.PLUGIN_INSTALL_PATH,"keeweb/plugins/siyuan","manifest.json")},"json")),this.manifest}saveKeeWebPluginConfig(){var s;const n=this.local[O.LOCAL_STORAGE_KEY_PLUGINS];((s=n==null?void 0:n.plugins)==null?void 0:s.find(r=>{var i;return((i=r==null?void 0:r.manifest)==null?void 0:i.name)===this.manifest.name}))?this.config.keeweb.plugin.siyuan.enable=!0:this.config.keeweb.plugin.siyuan.enable=!1}getKeeWebSiyuanPlugin(){var n=this.local[O.LOCAL_STORAGE_KEY_PLUGINS],o;return n?Array.isArray(n.plugins)?o=n.plugins.find(s=>{var r;return((r=s==null?void 0:s.manifest)==null?void 0:r.name)===this.manifest.name}):n.plugins=[]:(n={autoUpdateDate:null,autoUpdateAppVersion:null,plugins:[]},this.local[O.LOCAL_STORAGE_KEY_PLUGINS]=n),{plugins:n,plugin:o}}get isKeeWebSiyuanPluginInstalled(){const{plugin:n}=this.getKeeWebSiyuanPlugin();return!!n}async installKeeWebPlugin(){var{plugins:n,plugin:o}=this.getKeeWebSiyuanPlugin();o||n.plugins.push({manifest:this.manifest,url:this.KEEWEB_PLUGIN_PATHANEM,enabled:!0,autoUpdate:!0}),this.config.keeweb.plugin.siyuan.enable=!0,this.setLocalStorageItem(O.LOCAL_STORAGE_KEY_PLUGINS,n),await Promise.allSettled([this.putKeeWebPluginFile("js"),this.putKeeWebPluginFile("css")]),await Promise.allSettled([this.saveIDB(O.IDB_SCHEMA.PluginFiles.name),this.saveLocal(),this.updateConfig()])}async uninstallKeeWebPlugin(){const{plugins:n,plugin:o}=this.getKeeWebSiyuanPlugin();if(o){const s=n.plugins.indexOf(o);n.plugins.splice(s,1)}this.config.keeweb.plugin.siyuan.enable=!1,this.setLocalStorageItem(O.LOCAL_STORAGE_KEY_PLUGINS,n),await Promise.allSettled([this.deleteKeeWebPluginFile("js"),this.deleteKeeWebPluginFile("css")]),await Promise.allSettled([this.saveIDB(O.IDB_SCHEMA.PluginFiles.name),this.saveLocal(),this.updateConfig()])}};B(O,"GLOBAL_CONFIG_NAME","config.json"),B(O,"LOCAL_STORAGE_NAME","local.json"),B(O,"LOCAL_STORAGE_KEY_PREFIX","plugin-keepass-"),B(O,"LOCAL_STORAGE_KEY_PLUGINS",`${O.LOCAL_STORAGE_KEY_PREFIX}plugins`),B(O,"LOCAL_STORAGE_KEY_FILE_INFO",`${O.LOCAL_STORAGE_KEY_PREFIX}file-info`),B(O,"CUSTOM_TAB_TYPE_KEEWEB","-keeweb-tab"),B(O,"IDB_SCHEMA",{FilesCache:{name:"FilesCache",stores:{files:{name:"files"}}},PluginFiles:{name:"PluginFiles",stores:{files:{name:"files"}}}}),B(O,"IDB_ENTRIES",O.iterateIDB());let Mt=O;module.exports=Mt;
